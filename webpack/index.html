<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack | 一蓑烟雨、汪汪汪</title>
    <meta name="description" content="一蓑烟雨、汪汪汪的个人站点">
    <link rel="icon" href="/blog/icon.png">
    
    <link rel="preload" href="/blog/assets/css/0.styles.4a250181.css" as="style"><link rel="preload" href="/blog/assets/js/app.02d901a9.js" as="script"><link rel="preload" href="/blog/assets/js/4.151a486d.js" as="script"><link rel="preload" href="/blog/assets/js/7.adb24d6e.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.a558116b.js"><link rel="prefetch" href="/blog/assets/js/11.903c8df3.js"><link rel="prefetch" href="/blog/assets/js/12.d588a0e7.js"><link rel="prefetch" href="/blog/assets/js/13.ceb3868c.js"><link rel="prefetch" href="/blog/assets/js/14.0eb038d3.js"><link rel="prefetch" href="/blog/assets/js/15.e2aa1666.js"><link rel="prefetch" href="/blog/assets/js/16.9d092714.js"><link rel="prefetch" href="/blog/assets/js/2.0b00fc29.js"><link rel="prefetch" href="/blog/assets/js/3.0510b9ed.js"><link rel="prefetch" href="/blog/assets/js/5.bd59292c.js"><link rel="prefetch" href="/blog/assets/js/6.86ff566b.js"><link rel="prefetch" href="/blog/assets/js/8.11d6cc08.js"><link rel="prefetch" href="/blog/assets/js/9.c284e81d.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.4a250181.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">一蓑烟雨、汪汪汪</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/interview/" class="nav-link">前端面试之道</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript书籍</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/books/你不知道的javascript/你不知道的javascript上.html" class="nav-link">你不知道的JavaScript(上)</a></li><li class="dropdown-item"><!----> <a href="/blog/books/你不知道的javascript/你不知道的javascript中.html" class="nav-link">你不知道的JavaScript(中)</a></li></ul></div></div><div class="nav-item"><a href="/blog/designPattern/" class="nav-link">JavaScript设计模式</a></div><div class="nav-item"><a href="/blog/algorithm/" class="nav-link">数据结构和算法</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Vue.js</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue/" class="nav-link">Vue基础知识</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/principle.html" class="nav-link">Vue原理剖析</a></li></ul></div></div><div class="nav-item"><a href="/blog/webpack/" class="nav-link router-link-exact-active router-link-active">Webpack</a></div><div class="nav-item"><a href="/blog/vuepress/" class="nav-link">VuePress</a></div><div class="nav-item"><a href="/blog/git/" class="nav-link">Git</a></div> <a href="https://github.com/wangtunan/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/interview/" class="nav-link">前端面试之道</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript书籍</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/books/你不知道的javascript/你不知道的javascript上.html" class="nav-link">你不知道的JavaScript(上)</a></li><li class="dropdown-item"><!----> <a href="/blog/books/你不知道的javascript/你不知道的javascript中.html" class="nav-link">你不知道的JavaScript(中)</a></li></ul></div></div><div class="nav-item"><a href="/blog/designPattern/" class="nav-link">JavaScript设计模式</a></div><div class="nav-item"><a href="/blog/algorithm/" class="nav-link">数据结构和算法</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Vue.js</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue/" class="nav-link">Vue基础知识</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/principle.html" class="nav-link">Vue原理剖析</a></li></ul></div></div><div class="nav-item"><a href="/blog/webpack/" class="nav-link router-link-exact-active router-link-active">Webpack</a></div><div class="nav-item"><a href="/blog/vuepress/" class="nav-link">VuePress</a></div><div class="nav-item"><a href="/blog/git/" class="nav-link">Git</a></div> <a href="https://github.com/wangtunan/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Webpack</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/webpack/#追本溯源" class="sidebar-link">追本溯源</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/#面向过程开发" class="sidebar-link">面向过程开发</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#面向对象开发" class="sidebar-link">面向对象开发</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#现代开发模式" class="sidebar-link">现代开发模式</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#webpack初体验" class="sidebar-link">Webpack初体验</a></li></ul></li><li><a href="/blog/webpack/#安装" class="sidebar-link">安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/#全局安装" class="sidebar-link">全局安装</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#卸载" class="sidebar-link">卸载</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#本地安装-推荐" class="sidebar-link">本地安装(推荐)</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#版本号安装" class="sidebar-link">版本号安装</a></li></ul></li><li><a href="/blog/webpack/#起步" class="sidebar-link">起步</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/#创建项目结构" class="sidebar-link">创建项目结构</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#添加基础代码" class="sidebar-link">添加基础代码</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#安装webpack-2" class="sidebar-link">安装Webpack</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#添加配置文件" class="sidebar-link">添加配置文件</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#改写package-json文件" class="sidebar-link">改写package.json文件</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#第一次打包" class="sidebar-link">第一次打包</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#理解webpack打包输出" class="sidebar-link">理解webpack打包输出</a></li></ul></li><li><a href="/blog/webpack/#打包静态资源" class="sidebar-link">打包静态资源</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/#什么是loader？" class="sidebar-link">什么是loader？</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#使用loader打包图片" class="sidebar-link">使用loader打包图片</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#使用loader打包css" class="sidebar-link">使用loader打包CSS</a></li></ul></li><li><a href="/blog/webpack/#webpack核心" class="sidebar-link">Webpack核心</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/#使用webpackplugin" class="sidebar-link">使用WebpackPlugin</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#配置sourcemap" class="sidebar-link">配置SourceMap</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#使用webpackdevserver" class="sidebar-link">使用WebpackDevServer</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#模块热更新-hmr" class="sidebar-link">模块热更新(HMR)</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#处理es6语法" class="sidebar-link">处理ES6语法</a></li></ul></li><li><a href="/blog/webpack/#webpack进阶" class="sidebar-link">Webpack进阶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/#tree-shaking" class="sidebar-link">Tree Shaking</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#区分开发模式和生产模式" class="sidebar-link">区分开发模式和生产模式</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#代码分离-codesplitting" class="sidebar-link">代码分离(CodeSplitting)</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#splitchunksplugin配置参数详解" class="sidebar-link">SplitChunksPlugin配置参数详解</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#lazy-loading懒加载" class="sidebar-link">Lazy Loading懒加载</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#preloading-和prefetching" class="sidebar-link">PreLoading 和Prefetching</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#css代码分隔" class="sidebar-link">CSS代码分隔</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#webpack和浏览器缓存-caching" class="sidebar-link">Webpack和浏览器缓存(Caching)</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#shimming" class="sidebar-link">Shimming</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#处理全局this指向问题" class="sidebar-link">处理全局this指向问题</a></li></ul></li><li><a href="/blog/webpack/#webpack配置案例" class="sidebar-link">Webpack配置案例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/#如何打包一个库文件-library" class="sidebar-link">如何打包一个库文件(Library)</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#pwa配置" class="sidebar-link">PWA配置</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#typescript配置" class="sidebar-link">TypeScript配置</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#webpackdevserver请求转发" class="sidebar-link">WebpackDevServer请求转发</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#多页打包" class="sidebar-link">多页打包</a></li></ul></li><li><a href="/blog/webpack/#webpack性能优化" class="sidebar-link">Webpack性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/#打包分析" class="sidebar-link">打包分析</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#缩小文件的搜索范围" class="sidebar-link">缩小文件的搜索范围</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#tree-shaking去掉冗余的代码" class="sidebar-link">Tree Shaking去掉冗余的代码</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#dllplugin减少第三方库的编译次数" class="sidebar-link">DllPlugin减少第三方库的编译次数</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#happypack插件开启多线程打包" class="sidebar-link">HappyPack插件开启多线程打包</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#uglifyjs插件压缩代码" class="sidebar-link">UglifyJS插件压缩代码</a></li></ul></li><li><a href="/blog/webpack/#编写自己的loader" class="sidebar-link">编写自己的Loader</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/#如何编写及使用自己的loader" class="sidebar-link">如何编写及使用自己的Loader</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#如何向自己的loader传参" class="sidebar-link">如何向自己的Loader传参</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#如何在自己的loader写异步代码" class="sidebar-link">如何在自己的Loader写异步代码</a></li></ul></li><li><a href="/blog/webpack/#编写自己的plugin" class="sidebar-link">编写自己的Plugin</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/#plugin基础" class="sidebar-link">plugin基础</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#如何传递参数-2" class="sidebar-link">如何传递参数</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/#如何编写及使用自己的plugin" class="sidebar-link">如何编写及使用自己的Plugin</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="webpack"><a href="#webpack" aria-hidden="true" class="header-anchor">#</a> Webpack <span class="badge tip top" data-v-79c83af0>4.0+</span></h1> <div class="tip custom-block"><p class="custom-block-title">说明</p> <p>本篇博客由慕课网视频<a href="https://coding.imooc.com/class/316.html" target="_blank" rel="noopener noreferrer">从基础到实战手把手带你掌握新版Webpack4.0<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>(<strong>Dell-Lee</strong>)阅读整理而来，观看视频请支持正版。</p></div> <div class="warning custom-block"><p class="custom-block-title">注意</p> <p>本篇博客 Webpack 版本是<code>4.0+</code>，请确保你安装了<code>Node.js</code>最新版本。</p></div> <p>Webpack 的核心概念是一个 <strong>模块打包工具</strong> ，它的主要目标是将<code>js</code>文件打包在一起，打包后的文件用于在浏览器中使用，但它也能胜任 <strong>转换(<code>transform</code>)</strong> 、<strong>打包(<code>bundle</code>)</strong> 或 <strong>包裹(<code>package</code>)</strong> 任何其他资源。</p> <h2 id="追本溯源"><a href="#追本溯源" aria-hidden="true" class="header-anchor">#</a> 追本溯源</h2> <p>在学习 Webpack 之前，我们有必要来了解一些前端领域的开发历程，只有明白了这些开发历程，才能更加清楚 Webpack 是怎么应运而生的，又能给我们解决什么样的问题。</p> <h3 id="面向过程开发"><a href="#面向过程开发" aria-hidden="true" class="header-anchor">#</a> 面向过程开发</h3> <p><strong>特征：</strong> 一锅乱炖<br>
在早期 <code>js</code> 能力还非常有限的时候，我们通过面向过程的方式把代码写在同一个<code>.js</code>文件中，一个面向过程的开发模式可能如下所示。<br></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- index.html代码 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>这里是我们网页的内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js代码</span>
<span class="token keyword">var</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// header模块</span>
<span class="token keyword">var</span> header <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
header<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'header'</span><span class="token punctuation">;</span>
root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// sidebar模块</span>
<span class="token keyword">var</span> sidebar <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sidebar<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'sidebar'</span><span class="token punctuation">;</span>
root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>sidebar<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// content模块</span>
<span class="token keyword">var</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
content<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'content'</span><span class="token punctuation">;</span>
root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="面向对象开发"><a href="#面向对象开发" aria-hidden="true" class="header-anchor">#</a> 面向对象开发</h3> <p><strong>特征：</strong> 面向对象开发模式便于代码维护，深入人心。<br>
随着 <code>js</code> 的不断发展，它所能解决的问题也越来越多，如果再像<strong>面向过程</strong>那样把所有代码写在同一个<code>.js</code>文件中，那么代码将变得非常难以理解和维护，此时<strong>面向对象</strong>开发模式便出现了，一个面向对象开发模式可能如下所示。<br></p> <p>在<code>index.html</code>中引入不同的模块：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- index.html代码 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>这里是我们网页的内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./src/header.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./src/sidebar.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./src/content.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>header.js</code>代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// header.js代码</span>
<span class="token keyword">function</span> <span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> header <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  header<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'header'</span><span class="token punctuation">;</span>
  root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>sidebar.js</code>代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// sidebar.js代码</span>
<span class="token keyword">function</span> <span class="token function">Sidebar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> sidebar <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sidebar<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'sidebar'</span><span class="token punctuation">;</span>
  root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>sidebar<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>content.js</code>代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// content.js代码</span>
<span class="token keyword">function</span> <span class="token function">Content</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  content<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'content'</span><span class="token punctuation">;</span>
  root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p><code>index.js</code>代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Sidebar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>不足：</strong> 以上的代码示例中，虽然使用<strong>面向对象</strong>开发模式解决了<strong>面向过程</strong>开发模式中的一些问题，但似乎又引入了一些新的问题。<br></p> <ol><li>每一个模块都需要引入一个<code>.js</code>文件，随着模块的增多，这会影响页面性能</li> <li>在<code>index.js</code>文件中，并不能直接看出模块的逻辑关系，必须去页面才能找到</li> <li>在<code>index.html</code>页面中，文件的引入顺序必须严格按顺序来引入，例如：<code>index.js</code>必须放在最后引入，如果把<code>header.js</code>文件放在<code>index.js</code>文件后引入，那么代码会报错</li></ol> <h3 id="现代开发模式"><a href="#现代开发模式" aria-hidden="true" class="header-anchor">#</a> 现代开发模式</h3> <p><strong>特征：</strong> 模块化加载方案让前端开发进一步工程化 <br>
根据<strong>面向对象</strong>开发模式中的一系列问题，随后各种<strong>模块化</strong>加载的方案如雨后春笋，例如：<code>ES Module</code>、<code>AMD</code>、<code>CMD</code>以及<code>CommonJS</code>等，一个<code>ES Module</code>模块化加载方案可能如下所示。<br></p> <p><code>index.html</code>代码：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- index.html代码 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>这里是我们网页的内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>header.js</code>代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// header.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> header <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  header<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'header'</span><span class="token punctuation">;</span>
  root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>sidebar.js</code>代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// sidebar.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Sidebar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> sidebar <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sidebar<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'sidebar'</span><span class="token punctuation">;</span>
  root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>sidebar<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>content.js</code>代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// content.js代码</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Content</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  content<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'content'</span><span class="token punctuation">;</span>
  root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>index.js</code>代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js代码</span>
<span class="token keyword">import</span> Header <span class="token keyword">from</span> <span class="token string">'./src/header.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Sidebar <span class="token keyword">from</span> <span class="token string">'./src/sidebar.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Content <span class="token keyword">from</span> <span class="token string">'./src/content.js'</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Sidebar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>注意：</strong> 以上代码并不能直接在浏览器上执行，因为浏览器并不能直接识别<code>ES Module</code>代码，需要借助其他工具来进行翻译，此时 Webpack 就粉墨登场了。</p> <h3 id="webpack初体验"><a href="#webpack初体验" aria-hidden="true" class="header-anchor">#</a> Webpack初体验</h3> <p>不建议跟随此小结一起安装，此次示例仅仅作为一个例子，详细学习步骤请直接阅读下一章节<a href="/blog/webpack/#安装">安装</a></p> <h4 id="生成package-json文件"><a href="#生成package-json文件" aria-hidden="true" class="header-anchor">#</a> 生成package.json文件</h4> <div class="tip custom-block"><p class="custom-block-title">参数说明</p> <p><code>-y</code>参数表示直接生成默认配置项的<code>package.json</code>文件，不加此参数需要一步步按需进行配置。</p></div> <div class="language-sh extra-class"><pre class="language-text"><code>$ npm init -y
</code></pre></div><p>生成的<code>package.json</code>文件：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-vuepress&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="安装webpack"><a href="#安装webpack" aria-hidden="true" class="header-anchor">#</a> 安装Webpack</h4> <div class="tip custom-block"><p class="custom-block-title">参数说明</p> <p><code>-D</code>参数代表在本项目下安装 Webpack ，它是<code>--save-dev</code>的简写</p></div> <div class="language-sh extra-class"><pre class="language-text"><code>$ npm install webpack webpack-cli -D
</code></pre></div><h4 id="修改代码"><a href="#修改代码" aria-hidden="true" class="header-anchor">#</a> 修改代码</h4> <div class="tip custom-block"><p class="custom-block-title">配置说明</p> <p><code>webpack</code>默认打包路径到<code>dist</code>文件夹，打包后的<code>.js</code>文件名字叫<code>main.js</code></p></div> <p>其他代码不动，将<code>index.html</code>中的<code>.js</code>文件改成如下引用方式(引用打包后的文件)：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- index.html代码 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>这里是我们网页的内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./dist/main.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="webpack打包"><a href="#webpack打包" aria-hidden="true" class="header-anchor">#</a> Webpack打包</h4> <div class="tip custom-block"><p class="custom-block-title">参数说明</p> <ol><li><code>npx webpack</code>代表在本项目下寻找 Webpack 打包命令，它区别于<code>npm</code>命令</li> <li><code>index.js</code>参数代表本次打包的入口是<code>index.js</code></li></ol></div> <div class="language-sh extra-class"><pre class="language-text"><code>$ npx webpack index.js
</code></pre></div><p>打包结果：
<img src="data:image/png;base64,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" alt="webpack打包结果"></p> <p>正如上面你所看到的那样，网页正确显示了我们期待的结果，这也是 Webpack 能为我们解决问题的一小部分能力，下面将正式开始介绍 Webpack 。</p> <h2 id="安装"><a href="#安装" aria-hidden="true" class="header-anchor">#</a> 安装</h2> <h3 id="全局安装"><a href="#全局安装" aria-hidden="true" class="header-anchor">#</a> 全局安装</h3> <div class="warning custom-block"><p class="custom-block-title">注意</p> <p>如果你只是想做一个 Webpack 的 Demo 案例，那么全局安装方法可能会比较适合你。如果你是在实际生产开发中使用，那么推荐你使用本地安装方法。</p></div> <h4 id="全局安装命令"><a href="#全局安装命令" aria-hidden="true" class="header-anchor">#</a> 全局安装命令</h4> <div class="tip custom-block"><p class="custom-block-title">参数说明</p> <p><code>webpack4.0+</code>的版本，必须安装<code>webpack-cli</code>，<code>-g</code>命令代表全局安装的意思</p></div> <div class="language-sh extra-class"><pre class="language-text"><code>$ npm install webpack webpack-cli -g
</code></pre></div><h3 id="卸载"><a href="#卸载" aria-hidden="true" class="header-anchor">#</a> 卸载</h3> <div class="tip custom-block"><p class="custom-block-title">参数说明</p> <p>通过<code>npm install</code>安装的模块，对应的可通过<code>npm uninstall</code>进行卸载</p></div> <div class="language-sh extra-class"><pre class="language-text"><code>$ npm uninstall webpack webpack-cli -g
</code></pre></div><h3 id="本地安装-推荐"><a href="#本地安装-推荐" aria-hidden="true" class="header-anchor">#</a> 本地安装(推荐)</h3> <div class="tip custom-block"><p class="custom-block-title">参数说明</p> <p>本地安装的<code>Webpack</code>意思是，只在你当前项目下有效。而通过全局安装的<code>Webpack</code>，如果两个项目的<code>Webpack</code>主版本不一致，则可能会造成其中一个项目无法正常打包。本地安装方式也是实际开发中推荐的一种<code>Webpack</code>安装方式。</p></div> <div class="language-sh extra-class"><pre class="language-text"><code>$ npm install webpack webpack-cli -D 或者 npm install webpack webpack-cli --save-dev
</code></pre></div><h3 id="版本号安装"><a href="#版本号安装" aria-hidden="true" class="header-anchor">#</a> 版本号安装</h3> <div class="tip custom-block"><p class="custom-block-title">参数说明</p> <p>如果你对<code>Webpack</code>的具体版本有严格要求，那么可以先去github的<code>Webpack</code>仓库查看历史版本记录或者使用<code>npm view webpack versions</code>查看<code>Webpack</code>的<code>npm</code>历史版本记录</p></div> <div class="language-sh extra-class"><pre class="language-text"><code>// 查看webpack的历史版本记录
$ npm view webpack versions

// 按版本号安装
$ npm install webpack@4.25.0 -D
</code></pre></div><h2 id="起步"><a href="#起步" aria-hidden="true" class="header-anchor">#</a> 起步</h2> <h3 id="创建项目结构"><a href="#创建项目结构" aria-hidden="true" class="header-anchor">#</a> 创建项目结构</h3> <p>现在我们来创建基本的项目结构，它可能是下面这样</p> <div class="language-sh extra-class"><pre class="language-text"><code>|-- webpack-vuepress
|   |-- index.html
|   |-- index.js
|   |-- package.json
</code></pre></div><p>其中<code>package.json</code>是利用下面的命令自动生成的配置文件</p> <div class="language-sh extra-class"><pre class="language-text"><code>$ npm init -y
</code></pre></div><h3 id="添加基础代码"><a href="#添加基础代码" aria-hidden="true" class="header-anchor">#</a> 添加基础代码</h3> <p>在创建了基本的项目结构以后，我们需要为我们创建的文件添加一些代码<br></p> <p><code>index.html</code>页面中的代码：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>这是最原始的网页内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 引用打包后的js文件 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./dist/main.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>index.js</code>文件中的代码：</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello,world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="安装webpack-2"><a href="#安装webpack-2" aria-hidden="true" class="header-anchor">#</a> 安装Webpack</h3> <p>运行如下命令安装<code>webpack4.0+</code>和<code>webpack-cli</code>：</p> <div class="language-sh extra-class"><pre class="language-text"><code>$ npm install webpack webpack-cli -D
</code></pre></div><h3 id="添加配置文件"><a href="#添加配置文件" aria-hidden="true" class="header-anchor">#</a> 添加配置文件</h3> <p>使用如下命令添加 Webpack 配置文件：</p> <div class="language-sh extra-class"><pre class="language-text"><code>$ touch webpack.config.js
</code></pre></div><p>使用此命令，变更后的项目结构大概如下所示：</p> <div class="language-sh extra-class"><pre class="language-text"><code>|-- webpack-vuepress
|   |-- index.html
|   |-- index.js
|   |-- webpack.config.js
|   |-- package.json
</code></pre></div><p>至此我们的基础目录已创建完毕，接下来需要改写<code>webpack.config.js</code>文件，它的代码如下：</p> <div class="tip custom-block"><p class="custom-block-title">解释</p> <ol><li><code>entry</code>配置项说明了<code>webpack</code>打包的入口文件。</li> <li><code>output</code>配置项说明了<code>webpack</code>输出配置：<code>filename</code>配置了打包后的文件叫<code>main.js</code></li> <li><code>path</code>配置了打包后的输出目录为<code>dist</code>文件夹下</li></ol></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// path为Node的核心模块</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token punctuation">:</span> <span class="token string">'./index.js'</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'main.js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="改写package-json文件"><a href="#改写package-json文件" aria-hidden="true" class="header-anchor">#</a> 改写package.json文件</h3> <div class="tip custom-block"><p class="custom-block-title">改写说明</p> <ol><li>添加<code>private</code>属性并设置为<code>true</code>：此属性能让我们的项目为私有的，防止意外发布代码</li> <li>移除<code>main</code>属性：我们的项目并不需要对外暴露一个入口文件</li> <li>添加<code>scripts</code>命令：即我们的打包命令</li></ol></div> <p>改写后的<code>package.json</code>文件如下所示：</p> <div class="language-json extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-vuepress&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;bundle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;webpack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.31.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;webpack-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.3.2&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="第一次打包"><a href="#第一次打包" aria-hidden="true" class="header-anchor">#</a> 第一次打包</h3> <div class="tip custom-block"><p class="custom-block-title">命令说明</p> <p><code>npm run</code>代表运行一个脚本命令，而<code>bundle</code>就是我们配置的打包命令，即<code>npm run bundle</code>就是我们配置的<code>webpack</code>打包命令。</p></div> <p>运行如下命令进行项目打包：</p> <div class="language-sh extra-class"><pre class="language-text"><code>$ npm run bundle
</code></pre></div><p>打包后的效果如下所示：
<img src="/blog/assets/img/5.d107e67a.png" alt="第一次打包后的效果"></p> <p>打包后的项目目录如下所示，可以看到我们多出了一个叫<code>dist</code>的目录，它里面有一个<code>main.js</code>文件</p> <div class="language-sh extra-class"><pre class="language-text"><code>|-- webpack-vuepress
|   |-- dist
|   |   |-- main.js
|   |-- index.html
|   |-- index.js
|   |-- webpack.config.js
|   |-- package.json
</code></pre></div><p>打包成功后，我们需要在浏览器中运行<code>index.html</code>，它的运行结果如下图所示
<img src="data:image/png;base64,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" alt="第一次打包后的效果"></p> <h3 id="理解webpack打包输出"><a href="#理解webpack打包输出" aria-hidden="true" class="header-anchor">#</a> 理解webpack打包输出</h3> <p>在上一节中，我们第一次运行了一个打包命令，它在控制台上有一些输出内容，这一节我们详细来介绍这些输出是什么意思：
<img src="/blog/assets/img/5.d107e67a.png" alt="第一次打包后的效果"></p> <ol><li><p><strong>Hash：</strong> <code>hash</code>代表本次打包的唯一<code>hash</code>值，每一次打包此值都是不一样的</p></li> <li><p><strong>Version：</strong> 详细展示了我们使用<code>webpack</code>的版本号</p></li> <li><p><strong>Time：</strong> 代表我们本次打包的耗时</p></li> <li><p><strong>Asset：</strong> 代表我们打包出的文件名称</p></li> <li><p><strong>Size：</strong> 代表我们打包出的文件的大小</p></li> <li><p><strong>Chunks：</strong> 代表打包后的<code>.js</code>文件对应的<code>id</code>，<code>id</code>从<code>0</code>开始，依次往后<code>+1</code></p></li> <li><p><strong>Chunks Names：</strong> 代表我们打包后的<code>.js</code>文件的名字，至于为何是<code>main</code>，而不是其他的内容，这是因为在我们的<code>webpack.config.js</code>中，<code>entry:'./index.js'</code>是对如下方式的简写形式：</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// path为Node的核心模块</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// entry: './index.js',</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    main<span class="token punctuation">:</span> <span class="token string">'./index.js'</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 其它配置</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="8"><li><p><strong>Entrypoint main = bundle.js：</strong> 代表我们打包的入口为<code>main</code></p></li> <li><p><strong>warning in configuration：</strong> 提示警告，意思是我们没有给<code>webpack.config.js</code>设置<code>mode</code>属性，<code>mode</code>属性有三个值：<code>development</code>代表开发环境、<code>production</code>代表生产环境、<code>none</code>代表既不是开发环境也不是生产环境。如果不写的话，默认是生产环境，可在配置文件中配置此项，配置后再次打包将不会再出现此警告。</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// path为Node的核心模块</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 其它配置</span>
  mode<span class="token punctuation">:</span> <span class="token string">'development'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="打包静态资源"><a href="#打包静态资源" aria-hidden="true" class="header-anchor">#</a> 打包静态资源</h2> <h3 id="什么是loader？"><a href="#什么是loader？" aria-hidden="true" class="header-anchor">#</a> 什么是loader？</h3> <div class="tip custom-block"><p class="custom-block-title">概念</p> <p><code>loader</code>是一种打包规则，它告诉了 Webpack 在遇到非<code>.js</code>文件时，应该如何处理这些文件</p></div> <p><code>loader</code>有如下几种固定的运用规则：</p> <ul><li>使用<code>test</code>正则来匹配相应的文件</li> <li>使用<code>use</code>来添加文件对应的<code>loader</code></li> <li>对于多个<code>loader</code>而言，从 <strong>右到左</strong> 依次调用</li></ul> <h3 id="使用loader打包图片"><a href="#使用loader打包图片" aria-hidden="true" class="header-anchor">#</a> 使用loader打包图片</h3> <div class="tip custom-block"><p class="custom-block-title">安装依赖</p> <p>打包图片需要用到<code>file-loader</code>或者<code>url-loader</code>，需使用<code>npm install</code>进行安装</p></div> <h4 id="一点小改动"><a href="#一点小改动" aria-hidden="true" class="header-anchor">#</a> 一点小改动</h4> <p>在打包图片之前，让我们把<code>index.html</code>移动到上一节打包后的<code>dist</code>目录下，<code>index.html</code>中相应的<code>.js</code>引入也需要修改一下，像下面这样</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./main.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="添加打包图片规则"><a href="#添加打包图片规则" aria-hidden="true" class="header-anchor">#</a> 添加打包图片规则</h4> <p>对于打包图片，我们需要在<code>webpack.config.js</code>中进行相应的配置，它可以像下面这样</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// path为Node的核心模块</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 其它配置</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.(png|jpg|gif)$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> <span class="token string">'file-loader'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="改写index-js"><a href="#改写index-js" aria-hidden="true" class="header-anchor">#</a> 改写<code>index.js</code></h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> avatar <span class="token keyword">from</span> <span class="token string">'./avatar.jpg'</span>

<span class="token keyword">var</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> avatar
root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
</code></pre></div><h4 id="打包后的项目目录"><a href="#打包后的项目目录" aria-hidden="true" class="header-anchor">#</a> 打包后的项目目录</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> dist
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> bd7a45571e4b5ccb8e7c33b7ce27070a<span class="token punctuation">.</span>jpg
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> main<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
<span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> avatar<span class="token punctuation">.</span>jpg
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
</code></pre></div><h4 id="打包结果"><a href="#打包结果" aria-hidden="true" class="header-anchor">#</a> 打包结果</h4> <p><img src="/blog/assets/img/9.ab9afd2c.png" alt="打包结果"></p> <h4 id="运用占位符"><a href="#运用占位符" aria-hidden="true" class="header-anchor">#</a> 运用占位符</h4> <p>在以上打包图片的过程中，我们发现打包生成的图片好像名字是一串乱码，如果我们要原样输出原图片的名字的话，又该如何进行配置呢？这个问题，可以使用 <strong>占位符</strong> 进行解决。</p> <div class="tip custom-block"><p class="custom-block-title">占位符说明</p> <p>文件占位符它有一些固定的规则，像下面这样：</p> <ul><li><code>[name]</code>代表原本文件的名字</li> <li><code>[ext]</code>代表原本文件的后缀</li> <li><code>[hash]</code>代表一个<code>md5</code>的唯一编码</li></ul></div> <p>根据占位符的规则再次改写<code>webpack.config.js</code>文件，</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// path为Node的核心模块</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 其它配置</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.(png|jpg|gif)$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> <span class="token string">'[name]_[hash].[ext]'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>根据上面占位符的运用，打包生成的图片，它的名字如下</p> <div class="language-sh extra-class"><pre class="language-text"><code>|-- dist
|   |-- avatar_bd7a45571e4b5ccb8e7c33b7ce27070a.jpg
</code></pre></div><h3 id="使用loader打包css"><a href="#使用loader打包css" aria-hidden="true" class="header-anchor">#</a> 使用loader打包CSS</h3> <div class="tip custom-block"><p class="custom-block-title">打包说明</p> <p>样式文件分为几种情况，每一种都需要不同的<code>loader</code>来处理：</p> <ol><li>普通<code>.css</code>文件，使用<code>style-loader</code>和<code>css-loader</code>来处理</li> <li><code>.less</code>文件，使用<code>less-loader</code>来处理</li> <li><code>.sass或者.scss</code>文件，需要使用<code>sass-loader</code>来处理</li> <li><code>.styl</code>文件，需要使用<code>stylus-loader</code>来处理</li></ol></div> <h4 id="打包css文件"><a href="#打包css文件" aria-hidden="true" class="header-anchor">#</a> 打包css文件</h4> <div class="tip custom-block"><p class="custom-block-title">安装依赖</p> <p>首先安装<code>style-loader</code>和<code>css-loader</code></p></div> <p>改写webpack配置文件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// path为Node的核心模块</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 其它配置</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.(png|jpg|gif)$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> <span class="token string">'[name]_[hash].[ext]'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>根目录下创建<code>index.css</code></p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.avatar</span><span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>改写<code>index.js</code>文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> avatar <span class="token keyword">from</span> <span class="token string">'./avatar.jpg'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./index.css'</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> avatar<span class="token punctuation">;</span>
img<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'avatar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>打包结果</strong> <img src="/blog/assets/img/10.93e887ca.png" alt="css打包结果"></p> <h4 id="打包sass文件"><a href="#打包sass文件" aria-hidden="true" class="header-anchor">#</a> 打包Sass文件</h4> <div class="tip custom-block"><p class="custom-block-title">安装依赖</p> <p>需要安装<code>sass-loader</code>和<code>node-sass</code></p></div> <p>改写<code>webpack.config.js</code>文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// path为Node的核心模块</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 其它配置</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.(png|jpg|gif)$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> <span class="token string">'[name]_[hash].[ext]'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.(sass|scss)$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span><span class="token string">'css-loader'</span><span class="token punctuation">,</span><span class="token string">'sass-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>根目录下添加<code>index-sass.sass</code>文件</p> <div class="language-scss extra-class"><pre class="language-scss"><code><span class="token selector">body</span><span class="token punctuation">{</span>
  <span class="token selector">.avatar-sass</span><span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>改写<code>index.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> avatar <span class="token keyword">from</span> <span class="token string">'./avatar.jpg'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./index.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./index-sass.sass'</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> avatar<span class="token punctuation">;</span>
img<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'avatar-sass'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>根据上面的配置和代码改写后，再次打包，打包的结果会是下面这个样子
<img src="/blog/assets/img/11.ac892a55.png" alt="打包结果"></p> <h4 id="自动添加css厂商前缀"><a href="#自动添加css厂商前缀" aria-hidden="true" class="header-anchor">#</a> 自动添加CSS厂商前缀</h4> <p>当我们在<code>css</code>文件中写一些需要处理兼容性的样式的时候，需要我们分别对于不同的浏览器书添加不同的厂商前缀，使用<code>postcss-loader</code>可以帮我们在<code>webpack</code>打包的时候自动添加这些厂商前缀。</p> <div class="tip custom-block"><p class="custom-block-title">安装依赖</p> <p>自动添加厂商前缀需要<code>npm install</code>安装<code>postcss-loader</code>和<code>autoprefixer</code></p></div> <div class="language-sh extra-class"><pre class="language-text"><code>npm install postcss-loader autoprefixer -D
</code></pre></div><p>修改<code>index-sass.sass</code></p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.avatar-sass</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>50px<span class="token punctuation">,</span>50px<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在修改<code>sass</code>文件代码后，我们需要对<code>webpack.config.js</code></p> <div class="language-json extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-json"><code><span class="token comment">// path为Node的核心模块</span>
const path = require('path');

module.exports = <span class="token punctuation">{</span>
  <span class="token comment">// 其它配置</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> /\.(png|jpg|gif)$/<span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">{</span>
          loader<span class="token operator">:</span> 'file-loader'<span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span>
            name<span class="token operator">:</span> '<span class="token punctuation">[</span>name<span class="token punctuation">]</span>_<span class="token punctuation">[</span>hash<span class="token punctuation">]</span>.<span class="token punctuation">[</span>ext<span class="token punctuation">]</span>'
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> /\.css$/<span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>'style-loader'<span class="token punctuation">,</span> 'css-loader'<span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> /\.(sass|scss)$/<span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>'style-loader'<span class="token punctuation">,</span>'css-loader'<span class="token punctuation">,</span>'sass-loader'<span class="token punctuation">,</span>'postcss-loader'<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>根目录下添加<code>postcss.config.js</code>，并添加代码</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>根据上面的配置，我们再次打包运行，在浏览器中运行<code>index.html</code>，它的结果如下图所示
<img src="/blog/assets/img/12.c47b1155.png" alt="打包运行结果"></p> <h4 id="模块化打包css文件"><a href="#模块化打包css文件" aria-hidden="true" class="header-anchor">#</a> 模块化打包CSS文件</h4> <div class="tip custom-block"><p class="custom-block-title">概念</p> <p><code>CSS</code>的模块化打包的理解是：除非我主动引用你的样式，否则你打包的样式不能影响到我。</p></div> <p>根目录下添加<code>createAvatar.js</code>文件，并填写下面这段代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> avatar <span class="token keyword">from</span> <span class="token string">'./avatar.jpg'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">CreateAvatar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  img<span class="token punctuation">.</span>src <span class="token operator">=</span> avatar<span class="token punctuation">;</span>
  img<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'avatar-sass'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>改写<code>index.js</code>，引入<code>createAvatar.js</code>并调用</p> <div class="language-js extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">import</span> avatar <span class="token keyword">from</span> <span class="token string">'./avatar.jpg'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> createAvatar <span class="token keyword">from</span> <span class="token string">'./createAvatar'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./index.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./index-sass.sass'</span><span class="token punctuation">;</span>

<span class="token function">createAvatar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> avatar<span class="token punctuation">;</span>
img<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'avatar-sass'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>打包运行</strong> <img src="/blog/assets/img/13.b80ad718.png" alt="打包运行"></p> <p>我们可以看到，在<code>createAvatar.js</code>中，我们写的<code>img</code>标签的样式，它受<code>index-sass.sass</code>样式文件的影响，如果要消除这种影响，需要我们开启对<code>css</code>样式文件的模块化打包。</p> <p>进一步改写<code>webpack.config.js</code></p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token comment">// path为Node的核心模块</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 其它配置</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.(png|jpg|gif)$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> <span class="token string">'[name]_[hash].[ext]'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.(sass|scss)$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            modules<span class="token punctuation">:</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'sass-loader'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>开启<code>css</code>模块化打包后，我们需要在<code>index.js</code>中做一点小小的改动，像下面这样子</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">import</span> avatar <span class="token keyword">from</span> <span class="token string">'./avatar.jpg'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> createAvatar <span class="token keyword">from</span> <span class="token string">'./createAvatar'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./index.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> style <span class="token keyword">from</span>  <span class="token string">'./index-sass.sass'</span><span class="token punctuation">;</span>

<span class="token function">createAvatar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> avatar<span class="token punctuation">;</span>
img<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>style<span class="token punctuation">[</span><span class="token string">'avatar-sass'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>打包运行后，我们发现使用<code>createAvatar.js</code>创建出来的<code>img</code>没有受到样式文件的影响，证明我们的<code>css</code>模块化配置已经生效，下图是<code>css</code>模块化打包的结果：
<img src="/blog/assets/img/14.a4386b37.png" alt="打包结果"></p> <h2 id="webpack核心"><a href="#webpack核心" aria-hidden="true" class="header-anchor">#</a> Webpack核心</h2> <h3 id="使用webpackplugin"><a href="#使用webpackplugin" aria-hidden="true" class="header-anchor">#</a> 使用WebpackPlugin</h3> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p><code>plugin</code>的作用是：当<code>webpack</code>运行到某一个阶段时，可以使用<code>plugin</code>来帮我们做一些事情。</p></div> <p>在使用<code>plugin</code>之前，我们先来改造一下我们的代码，首先删掉无用的文件，随后把<code>index.js</code>移动到<code>src</code>文件夹下。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> dist
<span class="token operator">|</span>   <span class="token operator">--</span> index<span class="token punctuation">.</span>html
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> postcss<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> src
<span class="token operator">|</span>   <span class="token operator">--</span> index<span class="token punctuation">.</span>js
<span class="token operator">--</span> webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
</code></pre></div><p>接下来再来清空一下<code>index.js</code>文件的代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dom<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'hello,world'</span><span class="token punctuation">;</span>
root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>最后我们来清理一下我们的<code>webpack.config.js</code>文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    main<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'bundle'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="html-webpack-plugin"><a href="#html-webpack-plugin" aria-hidden="true" class="header-anchor">#</a> html-webpack-plugin</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p><code>html-webpack-plugin</code>可以让我们使用固定的模板，再每次打包的时候自动生成一个<code>index.html</code>文件，并且它会自动帮我们引入我们打包后的<code>.js</code>文件</p></div> <p><strong>安装html-webpack-plugin</strong></p> <div class="language- extra-class"><pre class="language-text"><code>npm install html-webpack-plugin -D
</code></pre></div><p><strong>在src目录下创建index.html模板文件</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Html 模板<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>改写webpack.config.js</strong></p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> htmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    main<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token punctuation">:</span> <span class="token string">'src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'bundle'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>打包并运行bundle文件夹下的index.html页面</strong> <img src="/blog/assets/img/15.b63a52f1.png" alt="打包结果"></p> <h4 id="clean-webpack-plugin"><a href="#clean-webpack-plugin" aria-hidden="true" class="header-anchor">#</a> clean-webpack-plugin</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p><code>clean-webpack-plugin</code>能帮我们在打包之前自动删除打包目录以及打包目录下的所有文件</p></div> <p><strong>安装clean-webpack-plugin</strong></p> <div class="language- extra-class"><pre class="language-text"><code>npm install clean-webpack-plugin -D
</code></pre></div><p><strong>改写webpack.config.js配置文件</strong></p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> htmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cleanWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    main<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token punctuation">:</span> <span class="token string">'src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">cleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'dist.js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'bundle'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>打包结果</strong><br>
在运行打包命令后，自行在项目目录中观察</p> <h3 id="配置sourcemap"><a href="#配置sourcemap" aria-hidden="true" class="header-anchor">#</a> 配置SourceMap</h3> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p><code>source-map</code>是一种映射关系，它映射了打包后的代码和源代码之间的对应关系，一般通过<code>devtool</code>来配置。在开发环境中，推荐将<code>devtool</code>设置成<code>cheap-module-eval-source-map</code>，而在生产环境中，推荐将<code>devtool</code>设置成<code>cheap-module-source-map</code></p></div> <p><strong>devtool各个属性的解释以及打包速度：</strong> <img src="/blog/assets/img/16.495d7697.png" alt="devtool">;</p> <h3 id="使用webpackdevserver"><a href="#使用webpackdevserver" aria-hidden="true" class="header-anchor">#</a> 使用WebpackDevServer</h3> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p><code>webpack-dev-server</code>能帮助我们在源代码更改的情况下，自动帮我们打包我们的代码并启动一个小型的服务器。如果与热更新一起使用，它更能帮助我们高效的开发。</p></div> <h4 id="使用watch参数自动打包"><a href="#使用watch参数自动打包" aria-hidden="true" class="header-anchor">#</a> 使用watch参数自动打包</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p><code>--watch</code>参数能帮我们在源代码更改的情况下，虽然能自动打包，但我们必须得手动刷新浏览器，而且它不能帮我们开启一个小型的服务器。</p></div> <p><strong>改写package.json</strong>：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack-vuepress&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;version&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;description&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;private&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;scripts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;bundle&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;watch&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack --watch&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;keywords&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;author&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;license&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;devDependencies&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;autoprefixer&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^9.4.10&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;clean-webpack-plugin&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^2.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^2.1.1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;file-loader&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^3.0.1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^3.2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;node-sass&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^4.11.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^3.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;sass-loader&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^7.1.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^0.23.1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^1.1.2&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^4.29.6&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;webpack-cli&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^3.2.3&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;webpack-dev-server&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^3.2.1&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>npm run watch打包：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>npm run watch
</code></pre></div><p><strong>打包结果：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>$ npm run watch
<span class="token operator">&gt;</span> webpack<span class="token operator">-</span>vuepress@<span class="token number">1.0</span><span class="token number">.0</span> watch <span class="token constant">F</span><span class="token punctuation">:</span>\webpack\webpack<span class="token operator">-</span>vuepress
<span class="token operator">&gt;</span> webpack <span class="token operator">--</span>watch
webpack is watching the files…
Hash<span class="token punctuation">:</span> b051bf9c5cbc09e334ef
Version<span class="token punctuation">:</span> webpack <span class="token number">4.29</span><span class="token number">.6</span>
Time<span class="token punctuation">:</span> <span class="token number">332</span>ms
Built at<span class="token punctuation">:</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">06</span><span class="token punctuation">:</span><span class="token number">28</span>
      Asset       Size  Chunks             Chunk Names
    dist<span class="token punctuation">.</span>js   <span class="token number">3.78</span> KiB    main  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
dist<span class="token punctuation">.</span>js<span class="token punctuation">.</span>map    <span class="token number">3.6</span> KiB    main  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
 index<span class="token punctuation">.</span>html  <span class="token number">338</span> bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
Entrypoint main <span class="token operator">=</span> dist<span class="token punctuation">.</span>js dist<span class="token punctuation">.</span>js<span class="token punctuation">.</span>map
<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>index<span class="token punctuation">.</span>js<span class="token punctuation">]</span> <span class="token number">28</span> bytes <span class="token punctuation">{</span>main<span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
Child html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token keyword">for</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">:</span>
</code></pre></div><h4 id="使用webpack-dev-server打包"><a href="#使用webpack-dev-server打包" aria-hidden="true" class="header-anchor">#</a> 使用webpack-dev-server打包</h4> <p><strong>修改package.json文件：</strong></p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack-vuepress&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;version&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;description&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;private&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;scripts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;bundle&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;watch&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack --watch&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;dev&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack-dev-server&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;keywords&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;author&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;license&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;devDependencies&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;autoprefixer&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^9.4.10&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;clean-webpack-plugin&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^2.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^2.1.1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;file-loader&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^3.0.1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^3.2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;node-sass&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^4.11.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^3.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;sass-loader&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^7.1.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^0.23.1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^1.1.2&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^4.29.6&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;webpack-cli&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^3.2.3&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;webpack-dev-server&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^3.2.1&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>修改webpack.config.js：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> htmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cleanWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  devtool<span class="token punctuation">:</span> <span class="token string">'source-map'</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    main<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 启动bundle文件夹</span>
    contentBase<span class="token punctuation">:</span> <span class="token string">'./bundle'</span><span class="token punctuation">,</span>
    <span class="token comment">// 自动打开浏览器</span>
    open<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 端口3000</span>
    port<span class="token punctuation">:</span> <span class="token number">3000</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token punctuation">:</span> <span class="token string">'src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">cleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'dist.js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'bundle'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>打包结果：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>$ npm run dev
<span class="token operator">&gt;</span> webpack<span class="token operator">-</span>vuepress@<span class="token number">1.0</span><span class="token number">.0</span> dev <span class="token constant">F</span><span class="token punctuation">:</span>\webpack\webpack<span class="token operator">-</span>vuepress
<span class="token operator">&gt;</span> webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server
i ｢wds｣<span class="token punctuation">:</span> Project is running at http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token regex">/localhost:3000/</span>
i ｢wds｣<span class="token punctuation">:</span> webpack output is served <span class="token keyword">from</span> <span class="token operator">/</span>
i ｢wds｣<span class="token punctuation">:</span> Content not <span class="token keyword">from</span> webpack is served <span class="token keyword">from</span> <span class="token punctuation">.</span><span class="token operator">/</span>bundle
i ｢wdm｣<span class="token punctuation">:</span> wait until bundle finished<span class="token punctuation">:</span> <span class="token operator">/</span>
i ｢wdm｣<span class="token punctuation">:</span> Hash<span class="token punctuation">:</span> <span class="token number">752</span>df284a4aadbd70bd7
Version<span class="token punctuation">:</span> webpack <span class="token number">4.29</span><span class="token number">.6</span>
Time<span class="token punctuation">:</span> <span class="token number">606</span>ms
Built at<span class="token punctuation">:</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">07</span>
      Asset       Size  Chunks             Chunk Names
    dist<span class="token punctuation">.</span>js    <span class="token number">334</span> KiB    main  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
dist<span class="token punctuation">.</span>js<span class="token punctuation">.</span>map    <span class="token number">385</span> KiB    main  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
 index<span class="token punctuation">.</span>html  <span class="token number">338</span> bytes          <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
Entrypoint main <span class="token operator">=</span> dist<span class="token punctuation">.</span>js dist<span class="token punctuation">.</span>js<span class="token punctuation">.</span>map
</code></pre></div><h3 id="模块热更新-hmr"><a href="#模块热更新-hmr" aria-hidden="true" class="header-anchor">#</a> 模块热更新(HMR)</h3> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>HMR模块热更新能够让我们在不刷新浏览器的情况下，替换我们最新的代码。</p></div> <p><strong>修改webpack.config.js：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> htmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cleanWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  devtool<span class="token punctuation">:</span> <span class="token string">'source-map'</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    main<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span><span class="token string">'css-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 启动bundle文件夹</span>
    contentBase<span class="token punctuation">:</span> <span class="token string">'./bundle'</span><span class="token punctuation">,</span>
    <span class="token comment">// 自动打开浏览器</span>
    open<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 端口3000</span>
    port<span class="token punctuation">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
    <span class="token comment">// 模块热更新</span>
    hot<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    hotOnly<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token punctuation">:</span> <span class="token string">'src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">cleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'dist.js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'bundle'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="在css中的模块热更新"><a href="#在css中的模块热更新" aria-hidden="true" class="header-anchor">#</a> 在css中的模块热更新</h4> <p><strong>改写index.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'./style.css'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
btn<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'新增'</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>btn<span class="token punctuation">)</span><span class="token punctuation">;</span>

btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  dom<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'item'</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>创建style.css</strong></p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">div:nth-of-type(odd)</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> yellow<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>打包：</strong></p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p><code>item</code>的div是动态生成的，当我们改变<code>style.css</code>里面的代码时，模块热更新能帮我们在不刷新浏览器的情况下，替换掉样式的内容。</p></div> <div class="language-js extra-class"><pre class="language-js"><code>npm run dev
</code></pre></div><p><img src="/blog/assets/img/17.4460b1ce.png" alt="打包结果"></p> <h4 id="在js中的模块热更新"><a href="#在js中的模块热更新" aria-hidden="true" class="header-anchor">#</a> 在js中的模块热更新</h4> <p><strong>添加counter.js和number.js</strong>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// counter.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  dom<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'counter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  dom<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  dom<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    dom<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>dom<span class="token punctuation">.</span>innerHTML<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// number.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  dom<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span><span class="token string">'number'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  dom<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'1000'</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>改写index.js：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> counter <span class="token keyword">from</span> <span class="token string">'./counter'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> number <span class="token keyword">from</span> <span class="token string">'./number'</span><span class="token punctuation">;</span>
<span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>这部分代码虽然在<code>webpack.config.js</code>文件中配置了HMR，但是并不能做到模块热更新，还需要额外的写一点代码。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> counter <span class="token keyword">from</span> <span class="token string">'./counter'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> number <span class="token keyword">from</span> <span class="token string">'./number'</span><span class="token punctuation">;</span>
<span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 额外的模块HMR配置</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">'./number.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'number'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>模块热更新结果：</strong> 在初始化打开页面时，<code>number.js</code>中的<code>innerHTML</code>为1000，再次修改<code>number.js</code>中的<code>innerHTML</code>为122222000，模块热更新成功。
<img src="/blog/assets/img/25.d79ee3b0.png" alt="模块热更新结果"></p> <div class="tip custom-block"><p class="custom-block-title">思考</p> <p>为什么在书写<code>.css</code>样式时，不用写<code>module.hot</code>，而自己写的<code>.js</code>还要额外的写这些代码？<br></p></div> <p>这是因为，在写<code>.css</code>文件时，<code>css-loader</code>已经帮我们书写了<code>module.hot</code>，我们直接使用<code>css-loader</code>即可实现HMR。相同的道理，在变更<code>.vue</code>文件时也不用写<code>module.hot</code>，这是因为<code>vue-loader</code>已经帮我们写了。</p> <h3 id="处理es6语法"><a href="#处理es6语法" aria-hidden="true" class="header-anchor">#</a> 处理ES6语法</h3> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>我们在项目中书写的<code>ES6</code>代码，由于考虑到低版本浏览器的兼容性问题，需要把<code>ES6</code>代码转换成低版本浏览器能够识别的<code>ES5</code>代码。使用<code>babel-loader</code>和<code>@babel/core</code>来进行<code>ES6</code>和<code>ES5</code>之间的链接，使用<code>@babel/preset-env</code>来进行<code>ES6</code>转<code>ES5</code></p></div> <p><strong>清理项目目录：</strong></p> <ul><li>删除<code>counter.js</code>文件</li> <li>删除<code>number.js</code>文件</li> <li>删除<code>style.css</code>文件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> bundle
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> postcss<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> src
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>js
<span class="token operator">--</span> webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
</code></pre></div><p><strong>安装必要包：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 安装 babel-loader @babel/core</span>
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev babel<span class="token operator">-</span>loader @babel<span class="token operator">/</span>core

<span class="token comment">// 安装 @babel/preset-env</span>
npm install @babel<span class="token operator">/</span>preset<span class="token operator">-</span>env <span class="token operator">--</span>save<span class="token operator">-</span>dev

<span class="token comment">// 安装 @babel/polyfill进行ES5代码补丁</span>
</code></pre></div><p><strong>改写index.js文件：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'@babel/polyfill'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>

arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>改写webpack.config.js文件：</strong> 添加<code>rules</code>规则</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
      use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span><span class="token string">'css-loader'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> 
      test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span> 
      exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span> 
      loader<span class="token punctuation">:</span> <span class="token string">&quot;babel-loader&quot;</span> 
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>根目录下添加.babelrc文件：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;presets&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> bundle
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> dist<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> dist<span class="token punctuation">.</span>js<span class="token punctuation">.</span>map
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> postcss<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> src
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>js
<span class="token operator">--</span> <span class="token punctuation">.</span>babelrc
<span class="token operator">--</span> webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
</code></pre></div><p><strong>打包结果：</strong> 使用<code>npx webpack</code>打包
<img src="/blog/assets/img/26.388e651d.png" alt="打包结果"></p> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>这种方式打包，我们可以看到，由于添加了<code>@babel/polyfill</code>，导致整个转<code>ES6</code>的包都打包到了<code>dist.js</code>文件夹下，导致<code>dist.js</code>文件非常大，我们理想的是我们用到了哪些<code>ES6</code>语法，就帮我们转<code>ES5</code>，没有用到的，就不转。<br>
可以在<code>.babelrc</code>文件中使用属性<code>useBuiltIns:'usage'</code>来进行按需引入打包。</p></div> <p><img src="/blog/assets/img/27.c38b3f54.png" alt="打包结果"></p> <p><strong>更改.babelrc文件：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;presets&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;useBuiltIns&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;usage&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>打包结果：</strong> 可以明显看到<code>dist.js</code>变小了，只有86.3kb
<img src="/blog/assets/img/28.9548404f.png" alt="打包结果"></p> <h2 id="webpack进阶"><a href="#webpack进阶" aria-hidden="true" class="header-anchor">#</a> Webpack进阶</h2> <h3 id="tree-shaking"><a href="#tree-shaking" aria-hidden="true" class="header-anchor">#</a> Tree Shaking</h3> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Tree Shaking是一个术语，通常用于描述移除JavaScript中未使用的代码，在开发环境中，Tree Shaking还是会起作用，但未使用的代码依然还进行打包，这是因为保存正确的<code>source-map</code>的缘故。</p></div> <div class="warning custom-block"><p class="custom-block-title">注意</p> <p>Tree Shaking 只适用于<code>ES Module</code>语法(既通过<code>export</code>导出，<code>import</code>引入)，因为它依赖于<code>ES Module</code>的静态结构特性。</p></div> <p><strong>添加src/math.js文件：</strong> 定义两个方法并export出去</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">minus</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">-</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>改写index.js：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./math'</span>

<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>改写webpack.config.js：</strong> 更改 webpack 配置文件，进行 Tree Shaking配置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  devtool<span class="token punctuation">:</span> <span class="token string">'source-map'</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    main<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    usedExports<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>开发环境下打包结果：</strong> 使用<code>npx webpack</code>进行打包</p> <div class="tip custom-block"><p class="custom-block-title">打包结果分析</p> <p>虽然我们配置了 Tree Shaking，但在开发环境下，我们依然能够看到未使用过的<code>minus</code>方法，以下注释也清晰了说明了这一点，这是因为我们处于开发环境下打包。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/* harmony export (binding) */</span> 
__webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> add<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* unused harmony export minus */</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">minus</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">-</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>生产环境下打包结果：</strong> 将<code>webpack.config.js</code>中的<code>Mode</code>属性，由<code>development</code>改为<code>production</code>，再运行<code>npx webpack</code></p> <div class="tip custom-block"><p class="custom-block-title">打包代码分析</p> <p>这是一段<code>add</code>方法压缩后的代码，我们在打包后的<code>.js</code>文件中，并没有找到<code>minus</code>方法，证明在生产环境下，Tree Shaking 真正起了作用。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>n<span class="token punctuation">,</span>r</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> t<span class="token punctuation">,</span>o<span class="token punctuation">;</span>
  r<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span>
  t<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
  o<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>t<span class="token operator">+</span>o<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="sideeffects"><a href="#sideeffects" aria-hidden="true" class="header-anchor">#</a> SideEffects</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>由于 Tree Shaking作用于所有通过<code>import</code>引入的文件，如果我们引入第三方库，例如：<code>import _ from 'lodash'</code>或者<code>.css</code>文件，例如<code>import './style.css'</code> 时，如果我们不
做限制的话，Tree Shaking将起副作用，<code>SideEffects</code>属性能帮我们解决这个问题：它告诉<code>webpack</code>，我们可以对哪些文件不做 Tree Shaking</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 修改package.json</span>
<span class="token comment">// 如果不希望对任何文件进行此配置，可以设置sideEffects属性值为false</span>
<span class="token comment">// *.css 表示 对所有css文件不做 Tree Shaking</span>
<span class="token comment">// @babael/polyfill 表示 对@babel/polyfill不做 Tree Shaking</span>
<span class="token string">&quot;sideEffects&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;*.css&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;@babel/polyfill&quot;</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="区分开发模式和生产模式"><a href="#区分开发模式和生产模式" aria-hidden="true" class="header-anchor">#</a> 区分开发模式和生产模式</h3> <p>像上一节所提到的那样，如果我们要区分 Tree Shaking的开发环境和生产环境，那么我们每次打包的都要去更改相应的 Webpack配置文件
有没有什么办法能让我们少改一点代码呢？</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>区分开发环境和生产环境，最好的办法是把公用配置提取到一个配置文件，生产环境和开发环境只写自己需要的配置，在打包的时候再进行合并即可<br> <strong><code>webpack-merge</code></strong> 可以帮我们做到这个事情。</p></div> <p><strong>新建build/webpack.common.js：</strong> 新建build文件夹，在此文件夹下新建<code>webpack.common.js</code>，提起公共配置到此文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> htmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cleanWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    main<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span><span class="token string">'css-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> 
        test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span> 
        exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span> 
        loader<span class="token punctuation">:</span> <span class="token string">&quot;babel-loader&quot;</span> 
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token punctuation">:</span> <span class="token string">'src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">cleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>新建build/webpack.dev.js：</strong> 保留开发环境独有的配置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  devtool<span class="token punctuation">:</span> <span class="token string">'cheap-module-eval-source-map'</span><span class="token punctuation">,</span>
  devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 启动bundle文件夹</span>
    contentBase<span class="token punctuation">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>
    <span class="token comment">// 自动打开浏览器</span>
    open<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 端口3000</span>
    port<span class="token punctuation">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
    <span class="token comment">// 模块热更新</span>
    hot<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    hotOnly<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    usedExports<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>新建build/webpack.prod.js：</strong> 保留生产环境独有的配置</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  devtool<span class="token punctuation">:</span> <span class="token string">'cheap-module-source-map'</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">webpack-merge</p> <p>利用<code>webpack-merge</code>进行文件合并，它需要用 npm 进行安装</p></div> <div class="language-js extra-class"><pre class="language-js"><code>$ npm install webpack<span class="token operator">-</span>merge <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p><strong>再次改造build/webpack.dev.js：</strong> 通过<code>webpack-merge</code>进行文件合并</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.common'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> devConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  devtool<span class="token punctuation">:</span> <span class="token string">'cheap-module-eval-source-map'</span><span class="token punctuation">,</span>
  devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 启动bundle文件夹</span>
    contentBase<span class="token punctuation">:</span> <span class="token string">'./bundle'</span><span class="token punctuation">,</span>
    <span class="token comment">// 自动打开浏览器</span>
    open<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 端口3000</span>
    port<span class="token punctuation">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
    <span class="token comment">// 模块热更新</span>
    hot<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    hotOnly<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    usedExports<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> devConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>再次改造build/webpack.prod.js：</strong> 通过<code>webpack-merge</code>进行文件合并</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.common'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> prodConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  devtool<span class="token punctuation">:</span> <span class="token string">'cheap-module-source-map'</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> prodConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="添加脚本命令"><a href="#添加脚本命令" aria-hidden="true" class="header-anchor">#</a> 添加脚本命令</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>通过更改<code>package.json</code>文件，添加<code>dev</code>和<code>build</code> 两个Script脚本命令</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;scripts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;dev&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack-dev-server --config ./build/webpack.dev.js&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;build&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack --config ./build/webpack.prod.js&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">注意</p> <p>当我们运行<code>npm run build</code>时，dist目录打包到了<code>build</code>文件夹下了，这是因为我们把<code>webpack</code>相关的配置放到了<code>build</code>文件夹下后，并没有做其他配置，<code>webpack</code>会认为<code>build</code>文件夹会是根目录</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> build
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> dist
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> main<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> main<span class="token punctuation">.</span>js<span class="token punctuation">.</span>map
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>common<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> postcss<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
<span class="token operator">--</span> src
    <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
    <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>js
    <span class="token operator">|</span><span class="token operator">--</span> math<span class="token punctuation">.</span>js
</code></pre></div><p><strong>再次修改build/webpack.common.js：</strong> 修改<code>output</code>属性即可</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code>output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  filename<span class="token punctuation">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
  path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'../dist'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>打包结果：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> build
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>common<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> dist
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> main<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> main<span class="token punctuation">.</span>js<span class="token punctuation">.</span>map
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> postcss<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> src
    <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
    <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>js
    <span class="token operator">|</span><span class="token operator">--</span> math<span class="token punctuation">.</span>js
</code></pre></div><h3 id="代码分离-codesplitting"><a href="#代码分离-codesplitting" aria-hidden="true" class="header-anchor">#</a> 代码分离(CodeSplitting)</h3> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Code Splitting 的核心是把很大的文件，分离成更小的块，让浏览器进行并行加载。常见的代码分割有三种形式：</p> <ul><li>收到进行分割，例如项目如果用到<code>lodash</code>，则把<code>lodash</code>单独打包成一个文件。</li> <li>同步导入的代码使用<code>webpack</code>配置进行代码分割。</li> <li>异步导入的代码，通过模块中的内联函数调用来分割代码。</li></ul></div> <p><strong>修改index.js代码：</strong> 在使用 npm 安装<code>lodash</code>后，修改<code>index.js</code>文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Dell'</span><span class="token punctuation">,</span><span class="token string">'Lee'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="同步导入代码分割"><a href="#同步导入代码分割" aria-hidden="true" class="header-anchor">#</a> 同步导入代码分割</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>在<code>webpack.common.js</code>中配置<code>splitChunks</code>属性即可</p></div> <div class="language-js extra-class"><pre class="language-js"><code>optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    chunks<span class="token punctuation">:</span> <span class="token string">'all'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>打包结果：</strong> <code>main.js</code>中是我们的业务代码，<code>vendors~main.js</code>是我们的公用库代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> build
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>common<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> dist
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> main<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> vendors<span class="token operator">~</span>main<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> postcss<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> src
    <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
    <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>js
    <span class="token operator">|</span><span class="token operator">--</span> math<span class="token punctuation">.</span>js
</code></pre></div><h4 id="异步导入代码分割"><a href="#异步导入代码分割" aria-hidden="true" class="header-anchor">#</a> 异步导入代码分割</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>异步带入的代码，不需要我们进行代码分割，<code>webpack</code>会自动帮我们把第三方库单独打包成一个文件</p></div> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>由于异步带入语法目前并没有得到全面支持，需要通过 npm 安装 <code>@babel/plugin-syntax-dynamic-import</code> 插件来进行转译</p></div> <div class="language-js extra-class"><pre class="language-js"><code>$ npm install @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>syntax<span class="token operator">-</span>dynamic<span class="token operator">-</span><span class="token keyword">import</span> <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p><strong>打包结果：</strong> 使用<code>npm run build</code>进行打包，<code>0.js</code>为第三方库打包的代码，<code>main.js</code>为我们的业务代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> build
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>common<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> dist
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> <span class="token number">0.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> main<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> postcss<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> src
    <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
    <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>js
    <span class="token operator">|</span><span class="token operator">--</span> math<span class="token punctuation">.</span>js
</code></pre></div><h3 id="splitchunksplugin配置参数详解"><a href="#splitchunksplugin配置参数详解" aria-hidden="true" class="header-anchor">#</a> SplitChunksPlugin配置参数详解</h3> <p>在上一节中，我们配置了<code>splitChunk</code>属性，它能让我们进行代码分割，其实这是因为 Webpack 底层使用了 <strong><code>splitChunksPlugin</code></strong> 插件。这个插件有很多可以配置的属性，它也有一些默认的配置参数，它的默认配置参数如下所示，我们将在下面为一些常用的配置项做一些说明。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...其它配置项</span>
  optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      chunks<span class="token punctuation">:</span> <span class="token string">'async'</span><span class="token punctuation">,</span>
      minSize<span class="token punctuation">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
      maxSize<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      minChunks<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      maxAsyncRequests<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      maxInitialRequests<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      automaticNameDelimiter<span class="token punctuation">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      cacheGroups<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        vendors<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          test<span class="token punctuation">:</span> <span class="token regex">/[\\/]node_modules[\\/]/</span><span class="token punctuation">,</span>
          priority<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">10</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
          minChunks<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          priority<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          reuseExistingChunk<span class="token punctuation">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="chunks参数"><a href="#chunks参数" aria-hidden="true" class="header-anchor">#</a> chunks参数</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p><code>chunks</code>参数，它告诉<code>webpack</code>应该对哪些模式进行打包，它的参数有三种：</p> <ul><li><code>async</code>，此值为默认值，只有异步导入的代码才会进行代码分割。</li> <li><code>initial</code>，与<code>async</code>相对，只有同步引入的代码才会进行代码分割。</li> <li><code>all</code>，此值可以看做是<code>async</code>和<code>inintal</code>的结合，表示无论是同步的代码还是异步的代码，都能进行代码分割。</li></ul></div> <p><strong>async：</strong> 配置了<code>async</code>，以下同步的代码无法进行代码分割</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// chunks: async 同步的代码不会进行代码分割。</span>
<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
element<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> element<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'**'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="minsize-和-maxsize"><a href="#minsize-和-maxsize" aria-hidden="true" class="header-anchor">#</a> minSize 和 maxSize</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p><code>minSize</code>默认值是30000，也就是30kb，当代码超过30kb时，才开始进行代码分割，小于30kb的则不会进行代码分割;与<code>minSize</code>相对的，<code>maxSize</code>默认值为0，为0表示不限制打包后文件的大小，一般这个属性不推荐设置，一定要设置的话，它的意思是：打包后的文件最大不能超过设定的值，超过的话就会进行代码分割。</p></div> <p><strong>写一个很小的math.js文件：</strong> 自己写一个很小的js文件，它小于30kb，以下代码不会进行代码分割</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>引用<code>js</code>文件</strong> ：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./math.js'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="minchunks"><a href="#minchunks" aria-hidden="true" class="header-anchor">#</a> minChunks</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>默认值为1，表示某个模块复用的次数大于或等于一次，就进行代码分割。</p></div> <p>如果将其设置大于1，例如：<code>minChunks:2</code>，在不考虑其他模块的情况下，以下代码不会进行代码分割：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 配置了minChunks: 2，以下lodash不会进行代码分割，因为只使用了一次 </span>
<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Dell'</span><span class="token punctuation">,</span> <span class="token string">'Lee'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="maxasyncrequests"><a href="#maxasyncrequests" aria-hidden="true" class="header-anchor">#</a> maxAsyncRequests</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>它的默认值是5，代表在进行异步代码分割时，前五个会进行代码分割，超过五个的不再进行代码分割</p></div> <h4 id="maxinitialrequests"><a href="#maxinitialrequests" aria-hidden="true" class="header-anchor">#</a> maxInitialRequests</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>它的默认值是3，代表在进行同步代码分割时，前三个会进行代码分割，超过三个的不在进行代码分割</p></div> <h4 id="automaticnamedelimiter"><a href="#automaticnamedelimiter" aria-hidden="true" class="header-anchor">#</a> automaticNameDelimiter</h4> <p>这是一个连接符，左边是代码分割的缓存组，右边是打包的入口文件的项，例如<code>vendors~main.js</code></p> <h4 id="cachegroups"><a href="#cachegroups" aria-hidden="true" class="header-anchor">#</a> cacheGroups</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>在进行代码分割时，会把符合条件的放在一组，然后把一组中的所有文件打包在一起，默认配置项中有两个分组，一个是<code>vendors</code>和<code>default</code></p></div> <p><strong>vendors组：</strong> 以下代码的含义是：将所有通过引用<code>node_modules</code>文件夹下的都放在<code>vendors</code>组中</p> <div class="language-js extra-class"><pre class="language-js"><code>vendors<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/[\\/]node_modules[\\/]/</span><span class="token punctuation">,</span>
  priority<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">10</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>default组：</strong> 默认组，意思是，不符合<code>vendors</code>的分组都将分配在<code>default</code>组中，如果一个文件即满足<code>vendors</code>分组，又满足<code>default</code>分组，那么通过<code>priority</code>的值进行取舍，值最大优先级越高。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
  minChunks<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  priority<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
  reuseExistingChunk<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>reuseExistingChunk：</strong> 中文解释是复用已存在的文件。意思是，如果有一个<code>a.js</code>文件，它里面引用了<code>b.js</code>，但我们其他模块又有引用<code>b.js</code>的地方。开启这个配置项后，在打包时会分析，<code>b.js</code>已经打包过了，直接可以复用，不用再次打包。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> a <span class="token keyword">from</span> <span class="token string">'a.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> b <span class="token keyword">from</span> <span class="token string">'b.js'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="lazy-loading懒加载"><a href="#lazy-loading懒加载" aria-hidden="true" class="header-anchor">#</a> Lazy Loading懒加载</h3> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p><code>Lazy Loading</code>懒加载的概念是，通过异步引入代码，它说的异步，并不是在页面一开始就加在，而是在合适的时机进行加载。</p></div> <p><strong>一个懒加载的例子</strong>：以下代码中的<code>lodash</code>，只有在页面点击的时候才加载。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getComponet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token punctuation">:</span> _ <span class="token punctuation">}</span>  <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: 'lodash' */</span> <span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  element<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'**'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> element<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">getComponet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">element</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>懒加载结果：</strong> <img src="/blog/assets/img/18.4e407686.png" alt="懒加载结果"></p> <h3 id="preloading-和prefetching"><a href="#preloading-和prefetching" aria-hidden="true" class="header-anchor">#</a> PreLoading 和Prefetching</h3> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>在以上<code>Lazy Loading</code>的例子中，只有当我们在页面点击时才会加载<code>lodash</code>，也有一些模块虽然是异步导入的，但我们希望能提前进行加载，<code>PreLoading</code>和<code>Prefetching</code>可以帮助我们实现这一点，但它们还有一个区别在于：<code>Prefetching</code>不会跟随主进程一些下载，而是等到主进程加载完毕，带宽释放后才进行加载，<code>PreLoading</code>会随主进程一起加载。</p></div> <p><strong>新建click.js</strong>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// click.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  element<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'Dell - Lee'</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>添加index.js代码</strong>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Prefetching代码预加载</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: 'lodash' */</span> <span class="token string">'./click.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">func</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>Prefetch结果：</strong> <img src="/blog/assets/img/19.eb4a763c.png" alt="Prefetch结果"></p> <h3 id="css代码分隔"><a href="#css代码分隔" aria-hidden="true" class="header-anchor">#</a> CSS代码分隔</h3> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>当我们在使用<code>style-loader</code>和<code>css-loader</code>打包<code>.css</code>文件时会直接把CSS文件打包进<code>.js</code>文件中，然后直接把样式通过<code>&lt;style&gt;&lt;/style&gt;</code>的方式写在页面，如果我们要把CSS单独打包在一起，然后通过<code>link</code>标签引入，那么可以使用<code>mini-css-extract-plugin</code>插件进行打包</p></div> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>截止到写此文档时，此插件还未支持HMR，意味着我们要使用这个插件进行打包CSS时，为了开发效率，我们需要配置在生产环境下，开发环境依然还是使用<code>style-loader</code>进行打包。</p></div> <p><strong>新建src/style.css文件：</strong> 在 src 目录下新建<code>style.css</code>文件并写如下样式</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>改写webpack.prod.js：</strong> 除了需要在<code>plugins</code>中使用插件以外，还需要在<code>Module</code>中，把CSS的<code>style-loader</code>替换成<code>MiniCssExtractPlugin.loader</code></p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.common'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> prodConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  devtool<span class="token punctuation">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span><span class="token string">'css-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> 
        test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span> 
        exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span> 
        loader<span class="token punctuation">:</span> <span class="token string">&quot;babel-loader&quot;</span> 
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> prodConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>改写index.js：</strong> 改写<code>index.js</code>文件，通过<code>import</code>引入我们所写的CSS文件。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'./style.css'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello,world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>打包结果：</strong> 使用<code>npm run build</code>进行打包，打包结果如下所示</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>如果发现并没有打包生成<code>main.css</code>文件，可能是<code>Tree Shaking</code>的副作用，应该在<code>package.json</code>中添加属性<code>sideEffects:['*.css']</code></p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> build
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>common<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> dist
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> main<span class="token punctuation">.</span>css
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> main<span class="token punctuation">.</span>css<span class="token punctuation">.</span>map
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> main<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> main<span class="token punctuation">.</span>js<span class="token punctuation">.</span>map
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> postcss<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
<span class="token operator">--</span> src
    <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
    <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>js
    <span class="token operator">|</span><span class="token operator">--</span> style<span class="token punctuation">.</span>css
</code></pre></div><h4 id="css压缩"><a href="#css压缩" aria-hidden="true" class="header-anchor">#</a> CSS压缩</h4> <p>我们再在<code>src</code>目录下新建<code>style1.css</code>文件，内容如下：</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">body</span><span class="token punctuation">{</span>
  <span class="token property">line-height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在<code>index.js</code>文件中引入此CSS文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'./style.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./style1.css'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello,world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>打包结果：</strong> 我们发现，虽然插件帮我们把CSS打包在了一个文件，但并没有合并压缩。</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">body</span><span class="token punctuation">{</span>
  <span class="token property">line-height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*# sourceMappingURL=main.css.map*/</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>要想把CSS文件进行合并压缩，需要安装<code>optimize-css-assets-webpack-plugin</code>插件</p></div> <p><strong>再次改写webpack.prod.js：</strong> 再次改写此配置文件</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.common'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> OptimizeCSSAssetsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;optimize-css-assets-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> prodConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  devtool<span class="token punctuation">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span><span class="token string">'css-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> 
        test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span> 
        exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span> 
        loader<span class="token punctuation">:</span> <span class="token string">&quot;babel-loader&quot;</span> 
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    minimizer<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">OptimizeCSSAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> prodConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>打包结果：</strong> 再次使用<code>npm run build</code>进行打包，打包结果如下所示，可以看见，两个CSS文件的代码已经压缩合并了。</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">body</span><span class="token punctuation">{</span><span class="token property">background-color</span><span class="token punctuation">:</span>green<span class="token punctuation">;</span><span class="token property">line-height</span><span class="token punctuation">:</span>100px<span class="token punctuation">}</span>
</code></pre></div><h3 id="webpack和浏览器缓存-caching"><a href="#webpack和浏览器缓存-caching" aria-hidden="true" class="header-anchor">#</a> Webpack和浏览器缓存(Caching)</h3> <p>在讲这一小节之前，让我们清理下项目目录，改写下我们的<code>index.js</code>，删除掉一些没用的文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dom<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Dell'</span><span class="token punctuation">,</span> <span class="token string">'Lee'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'---'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>清理后的项目目录可能是这样的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> build
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>common<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> postcss<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> src
    <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
    <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>js
</code></pre></div><p>我们使用<code>npm run build</code>打包命令，打包我们的代码，可能会生成如下的文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> build
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>common<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> dist
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> main<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> vendors<span class="token operator">~</span>main<span class="token punctuation">.</span>chunk<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> postcss<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> src
    <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
    <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>js
</code></pre></div><p>我们可以看到，打包生成的dist目录下，文件名是<code>main.js</code>和<code>vendors~main.chunk.js</code>，如果我们把dist目录放在服务器部署的话，当用户第一次访问页面时，浏览器会自动把这两个<code>.js</code>文件缓存起来，下一次非强制性刷新页面时，会直接使用缓存起来的文件。<br>
假如，我们在用户第一次刷新页面和第二次刷新页面之间，我们修改了我们的代码，并再一次部署，这个时候由于浏览器缓存了这两个<code>.js</code>文件，所以用户界面无法获取最新的代码。<br>
那么，我们有办法能解决这个问题呢，答案是<code>[contenthash]</code>占位符，它能根据文件的内容，在每一次打包时生成一个唯一的hash值，只要我们文件发生了变动，就重新生成一个hash值，没有改动的话，<code>[contenthash]</code>则不会发生变动，可以在<code>output</code>中进行配置，如下所示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 开发环境下的output配置还是原来的那样，因为开发环境下，我们不用考虑缓存问题</span>
output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  filename<span class="token punctuation">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
  chunkFileName<span class="token punctuation">:</span> <span class="token string">'[name].chunk.js'</span><span class="token punctuation">,</span>
  path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'../dist'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 生产环境下的output配置</span>
output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  filename<span class="token punctuation">:</span> <span class="token string">'[name].[contenthash].js'</span><span class="token punctuation">,</span>
  chunkFilename<span class="token punctuation">:</span> <span class="token string">'[name].[contenthash].chunk.js'</span><span class="token punctuation">,</span>
  path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'../dist'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>打包结果：</strong> 使用<code>npm install build</code>进行打包，结果如下所示，可以看到每一个<code>.js</code>文件都有一个唯一的<code>hash</code>值，这样配置后就能有效解决浏览器缓存的问题。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> build
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>common<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> dist
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> main<span class="token punctuation">.</span><span class="token number">8</span>bef05e11ca1dc804836<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> vendors<span class="token operator">~</span>main<span class="token punctuation">.</span><span class="token number">20137</span>a4ad072bc0461a8<span class="token punctuation">.</span>chunk<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> postcss<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> src
    <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
    <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>js
</code></pre></div><h3 id="shimming"><a href="#shimming" aria-hidden="true" class="header-anchor">#</a> Shimming</h3> <p>有时候我们在引入第三方库的时候，不得不处理一些全局变量的问题，例如jQuery的<code>$</code>，lodash的<code>_</code>，但由于一些老的第三方库不能直接修改它的代码，这时我们能不能定义一个全局变量，当文件中存在<code>$</code>或者<code>_</code>的时候自动的帮他们引入对应的包。</p> <div class="tip custom-block"><p class="custom-block-title">解决办法</p> <p>这个问题，可以使用<code>ProvidePlugin</code>插件来解决，这个插件已经被Webpack内置，无需安装，直接使用即可。</p></div> <p><strong>添加src/jquery.ui.js文件：</strong> 在src目录下新建<code>jquery.ui.js</code>文件，代码如下所示，它使用了jQuery的<code>$</code>符号，创建这个文件，目的是为了来模仿第三方库。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token constant">UI</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'background'</span><span class="token punctuation">,</span><span class="token string">'green'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>修改index.js文件：</strong> 改写<code>index.js</code>文件，并在其中引入我们的<code>jquery.ui.js</code>文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">'jquery'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">UI</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./jquery.ui'</span><span class="token punctuation">;</span>

<span class="token constant">UI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">var</span> dom <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;div&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dom<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Dell'</span><span class="token punctuation">,</span> <span class="token string">'Lee'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'---'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>打包结果：</strong> 使用<code>npm run dev</code>进行打包，会发现，代码运行不起来，报错<code>$ is not defined</code>，这是因为虽然我们在<code>index.js</code>中引入的jQuery文件，但<code>$</code>符号只能在<code>index.js</code>才有效，在<code>jquery.ui.js</code>无效，报错是因为<code>jquery.ui.js</code>中<code>$</code>符号找不到引起的。
<img src="/blog/assets/img/20.c72fa0d1.png" alt="打包结果"></p> <p><strong>改写webpack.common.js文件：</strong> 在<code>webpack.common.js</code>文件中使用<code>ProvidePlugin</code>插件</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>配置<code>$:'jquery'</code>，只要我们文件中使用了<code>$</code>符号，它就会自动帮我们引入<code>jquery</code>，相当于<code>import $ from 'jquery'</code></p></div> <div class="language-js extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> htmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cleanWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    main<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token punctuation">:</span> <span class="token string">'src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">cleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      $<span class="token punctuation">:</span> <span class="token string">'jquery'</span><span class="token punctuation">,</span>
      _<span class="token punctuation">:</span> <span class="token string">'lodash'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>打包结果：</strong> 使用<code>npm run dev</code>进行打包，打包结果如下，可以发现，项目已经可以正确运行了。
<img src="/blog/assets/img/21.bac45c08.png" alt="打包结果"></p> <h3 id="处理全局this指向问题"><a href="#处理全局this指向问题" aria-hidden="true" class="header-anchor">#</a> 处理全局this指向问题</h3> <p>我们现在来思考一个问题，一个模块中的<code>this</code>到底指向什么，是模块自身还是全局的<code>window</code>对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js代码，在浏览器中输出：false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">===</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如上所示，如果我们使用<code>npm run dev</code>运行项目，运行<code>index.html</code>时，会在浏览器的<code>console</code>面板输出<code>false</code>，证明在模块中<code>this</code>指向模块自身，而不是全局的<code>window</code>对象，那么我们有什么办法来解决这个问题呢？</p> <div class="tip custom-block"><p class="custom-block-title">解决办法</p> <p>安装使用<code>imports-loader</code>来解决这个问题</p></div> <div class="language-js extra-class"><pre class="language-js"><code>$ npm install imports<span class="token operator">-</span>loader <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p><strong>改写webpack.common.js文件：</strong> 在<code>.js</code>的loader处理中，添加<code>imports-loader</code></p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br></div><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 其他配置</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> 
        test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span> 
        exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span> 
        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            loader<span class="token punctuation">:</span> <span class="token string">'imports-loader?this=&gt;window'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ... 其他配置</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>打包结果：</strong> 使用<code>npm run dev</code>来进行打包，运行<code>index.html</code>，查看<code>console</code>控制台，输出<code>true</code>，证明<code>this</code>这个时候已经指向了全局<code>window</code>对象，问题解决。
<img src="/blog/assets/img/22.d25b9794.png" alt="打包结果"></p> <h2 id="webpack配置案例"><a href="#webpack配置案例" aria-hidden="true" class="header-anchor">#</a> Webpack配置案例</h2> <h3 id="如何打包一个库文件-library"><a href="#如何打包一个库文件-library" aria-hidden="true" class="header-anchor">#</a> 如何打包一个库文件(Library)</h3> <p>在上面所有的 Webpack 配置中，几乎都是针对业务代码的，如果我们要打包发布一个库，让别人使用的话，该怎么配置？在下面的几小结中，我们将来讲一讲该怎么样打包一个库文件，并让这个库文件在多种场景能够使用。</p> <h4 id="创建一个全新的项目"><a href="#创建一个全新的项目" aria-hidden="true" class="header-anchor">#</a> 创建一个全新的项目</h4> <div class="tip custom-block"><p class="custom-block-title">步骤</p> <ul><li>创建library项目</li> <li>使用<code>npm init -y</code>进行配置<code>package.json</code></li> <li>新建<code>src</code>目录，创建<code>math.js</code>文件、<code>string.js</code>文件、<code>index.js</code>文件</li> <li>根目录下创建<code>webpack.config.js</code>文件</li> <li>安装<code>webpack</code>、<code>webpack-cli</code></li></ul></div> <h4 id="初始化package-json"><a href="#初始化package-json" aria-hidden="true" class="header-anchor">#</a> 初始化package.json</h4> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code><span class="token comment">// 初始化后，改写package.json</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;library&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;version&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;description&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;main&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;scripts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;build&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;keywords&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;author&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;license&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;MIT&quot;</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="创建src目录，并添加文件"><a href="#创建src目录，并添加文件" aria-hidden="true" class="header-anchor">#</a> 创建src目录，并添加文件</h4> <p><strong>math.js文件代码：</strong> 添加四个四则混合运算的方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">minus</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">division</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">/</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>string.js文件代码：</strong> 添加一个<code>join</code>方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> <span class="token string">''</span> <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>index.js文件代码：</strong> 引用<code>math.js</code>、<code>string.js</code>并导出</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> math <span class="token keyword">from</span> <span class="token string">'./math'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> string <span class="token keyword">from</span> <span class="token string">'./string'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> math<span class="token punctuation">,</span> string <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="添加webpack-config-js"><a href="#添加webpack-config-js" aria-hidden="true" class="header-anchor">#</a> 添加webpack.config.js</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>因为我们是要打包一个库文件，所以<code>mode</code>只配置为生产环境即可。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'library.js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="安装webpack-3"><a href="#安装webpack-3" aria-hidden="true" class="header-anchor">#</a> 安装webpack</h4> <div class="language- extra-class"><pre class="language-text"><code>$ npm install webpack webpack-cli -D
</code></pre></div><h4 id="项目整体目录结构"><a href="#项目整体目录结构" aria-hidden="true" class="header-anchor">#</a> 项目整体目录结构</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> src
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> math<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> string<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
</code></pre></div><h4 id="进行第一次打包"><a href="#进行第一次打包" aria-hidden="true" class="header-anchor">#</a> 进行第一次打包</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>使用<code>npm run build</code>进行第一次打包，在<code>dist</code>目录下生成了<code>library.js</code>，在<code>dist</code>目录下新建<code>index.html</code></p></div> <div class="language-js extra-class"><pre class="language-js"><code>$ npm run build
$ cd dist
$ touch index<span class="token punctuation">.</span>html
</code></pre></div><p>在<code>index.html</code>中引入<code>library.js</code>文件：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./library.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>至此，我们已经基本把项目目录搭建完毕，现在我们来考虑一下，可以在哪些情况下使用我们打包的文件：</p> <ul><li>使用<code>ES Module</code>语法引入，例如<code>import library from 'library'</code></li> <li>使用<code>CommonJS</code>语法引入，例如<code>const library = require('library')</code></li> <li>使用<code>AMD</code>、<code>CMD</code>语法引入，例如<code>require(['library'], function() {// todo})</code></li> <li>使用<code>script</code>标签引入，例如<code>&lt;script src=&quot;library.js&quot;&gt;&lt;/script&gt;</code></li></ul> <div class="tip custom-block"><p class="custom-block-title">打包方案</p> <p>针对以上几种使用场景，我们可以在<code>output</code>中配置<code>library</code>和<code>libraryTarget</code>属性(注意：这里的<code>library</code>和<code>libraryTarget</code>和我们的库名字<code>library.js</code>没有任何关系，前者是<code>webpack</code>固有的配置项，后者只是我们随意取的一个名字)</p></div> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    library<span class="token punctuation">:</span> <span class="token string">'library'</span><span class="token punctuation">,</span>
    libraryTarget<span class="token punctuation">:</span> <span class="token string">'umd'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>配置属性说明：</strong> <br></p> <ul><li><strong><code>library</code></strong>：这个属性指，我们库的全局变量是什么，类似于<code>jquery</code>中的<code>$</code>符号</li> <li><strong><code>libraryTarget</code></strong>: 这个属性指，我们库应该支持的模块引入方案，<code>umd</code>代表支持<code>ES Module</code>、<code>CommomJS</code>、<code>AMD</code>以及<code>CMD</code></li></ul> <p><strong>打包结果：</strong> 在配置完毕后，我们再使用<code>npm run build</code>进行打包，并在浏览器中运行<code>index.html</code>，在<code>console</code>控制台输出<code>library</code>这个全局变量，结果如下图所示:
<img src="/blog/assets/img/23.bb73be60.png" alt="打包结果"></p> <p>以上我们所写的库非常简单，在实际的库开发过程中，往往需要使用到一些第三方库，如果我们不做其他配置的话，第三方库会直接打包进我们的库文件中。如果用户在使用我们的库文件时，也引入了这个第三方库，就造成了重复引用的问题，那么如何解决这个问题呢？</p> <div class="tip custom-block"><p class="custom-block-title">解决办法</p> <p>可以在<code>webpack.config.js</code>文件中配置<code>externals</code>属性</p></div> <p><strong>修改string.js的代码：</strong> 在<code>join</code>方法中，我们使用第三方库<code>lodash</code>中的<code>_join()</code>方法来进行字符串的拼接。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>不做配置时的打包结果：</strong> 在修改完毕<code>string.js</code>文件后，使用<code>npm run build</code>进行打包，发现<code>lodash</code>直接打包进了我们的库文件，造成库文件积极臃肿，有70.8kb。</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br></div><pre class="language-js"><code>$ npm run build
Built at<span class="token punctuation">:</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">47</span><span class="token punctuation">:</span><span class="token number">25</span>
     Asset      Size  Chunks             Chunk Names
library<span class="token punctuation">.</span>js  <span class="token number">70.8</span> KiB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
</code></pre></div><p><strong>配置externals：</strong></p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  externals<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'lodash'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'library.js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    library<span class="token punctuation">:</span> <span class="token string">'library'</span><span class="token punctuation">,</span>
    libraryTarget<span class="token punctuation">:</span> <span class="token string">'umd'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>配置externals后的打包结果：</strong> 可以看到，我们的库文件又变回原来的大小了，证明我们的配置起作用了。</p> <div class="language-js extra-class"><pre class="language-js"><code>$ npm run build
Built at<span class="token punctuation">:</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">51</span><span class="token punctuation">:</span><span class="token number">22</span>
     Asset      Size  Chunks             Chunk Names
library<span class="token punctuation">.</span>js  <span class="token number">1.63</span> KiB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
</code></pre></div><h4 id="如何发布并使用我们的库文件"><a href="#如何发布并使用我们的库文件" aria-hidden="true" class="header-anchor">#</a> 如何发布并使用我们的库文件</h4> <div class="tip custom-block"><p class="custom-block-title">步骤</p> <p>要想发布我们的库到<code>npm</code>上，步骤如下：</p> <ul><li>注册<code>npm</code>账号</li> <li>修改<code>package.json</code>文件的入口，修改为：<code>&quot;main&quot;: &quot;./dist/library.js&quot;</code></li> <li>运行<code>npm adduser</code>添加账户名称</li> <li>运行<code>npm publish</code>命令进行发布</li> <li>运行<code>npm install xxx</code>来进行安装</li></ul></div> <div class="warning custom-block"><p class="custom-block-title">警告</p> <ul><li>为了维护<code>npm</code>仓库的干净，我们并未实际运行<code>npm publish</code>命令，因为我们的库是无意义的，发布上去属于垃圾代码，所以为了维护<code>npm</code>仓库的干净性，请自行尝试发布。</li> <li>自己包的名字不能和<code>npm</code>仓库中已有的包名字重复，所以需要在<code>package.json</code>中给<code>name</code>属性起一个特殊一点的名字才行，例如<code>&quot;name&quot;: &quot;why-library-2019&quot;</code></li></ul></div> <h3 id="pwa配置"><a href="#pwa配置" aria-hidden="true" class="header-anchor">#</a> PWA配置</h3> <div class="tip custom-block"><p class="custom-block-title">概念以及作用</p> <p>PWA全称Progressive Web Application(渐进式应用框架)，它能让我们主动缓存文件，这样用户离线后依然能够使用我们缓存的文件打开网页，而不至于让页面挂掉，实现这种技术需要安装<code>workbox-webpack-plugin</code>插件</p></div> <h4 id="安装插件"><a href="#安装插件" aria-hidden="true" class="header-anchor">#</a> 安装插件</h4> <div class="language-js extra-class"><pre class="language-js"><code>$ npm install workbox<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h4 id="webpack-config-js文件配置"><a href="#webpack-config-js文件配置" aria-hidden="true" class="header-anchor">#</a> webpack.config.js文件配置</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// PWA只有在线上环境才有效，所以需要在webpack.prod.js文件中进行配置</span>
<span class="token keyword">const</span> WorkboxWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'workbox-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> prodConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 其他配置</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">WorkboxWebpackPlugin<span class="token punctuation">.</span>GenerateSW</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      clientsClaim<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      skipWaiting<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> prodConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="改写index-js-2"><a href="#改写index-js-2" aria-hidden="true" class="header-anchor">#</a> 改写index.js</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>需要判断浏览器是否支持PWA，支持的时候我们才进行注册，注册的<code>.js</code>文件为我们打包后的<code>service-worker.js</code>文件。</p></div> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello,world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/service-worker.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">register</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'注册成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'注册失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="打包生成线上文件"><a href="#打包生成线上文件" aria-hidden="true" class="header-anchor">#</a> 打包生成线上文件</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p><code>precache-manifest.xxxxx.js</code>文件和<code>service-worker.js</code>就能让我们实现PWA</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> build
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>common<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> dist
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> main<span class="token punctuation">.</span>f28cbac9bec3756acdbe<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> main<span class="token punctuation">.</span>f28cbac9bec3756acdbe<span class="token punctuation">.</span>js<span class="token punctuation">.</span>map
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> precache<span class="token operator">-</span>manifest<span class="token punctuation">.</span>ea54096f38009609a46058419fc7009b<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> service<span class="token operator">-</span>worker<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> postcss<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> src
    <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
    <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>js
</code></pre></div><h4 id="pwa实际效果"><a href="#pwa实际效果" aria-hidden="true" class="header-anchor">#</a> PWA实际效果</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>在<code>npm run dev</code>后，我们利用<code>webpack-dev-server</code>启动了一个小型的服务器，然后我们停掉这个服务器，刷新页面，PWA的实际结果如下图所示</p></div> <p><img src="/blog/assets/img/24.02ee716e.png" alt="PWA实际结果"></p> <h3 id="typescript配置"><a href="#typescript配置" aria-hidden="true" class="header-anchor">#</a> TypeScript配置</h3> <p>随着<code>TypeScript</code>的不断发展，相信未来使用<code>TypeScript</code>来编写 JS 代码将变成主流形式，那么如何在 Webpack 中配置支持<code>TypeScript</code>呢？</p> <div class="tip custom-block"><p class="custom-block-title">解决办法</p> <p>可以安装<code>ts-loader</code>和<code>typescript</code>来解决这个问题</p></div> <h4 id="新建一个项目webpack-typescript"><a href="#新建一个项目webpack-typescript" aria-hidden="true" class="header-anchor">#</a> 新建一个项目webpack-typescript</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>新创建一个项目，命名为<code>webpack-typescript</code>，并按如下步骤处理：</p> <ul><li>使用<code>npm init -y</code>初始化<code>package.json</code>文件，并在其中添加<code>build</code> Webpack打包命令</li> <li>新建<code>webpack.config.js</code>文件，并做一些简单配置，例如<code>entry</code>、<code>output</code>等</li> <li>新建<code>src</code>目录，并在<code>src</code>目录下新建<code>index.ts</code>文件</li> <li>在<code>src</code>目录下，新建<code>index.ts</code>文件</li> <li>新建<code>tsconfig.json</code>文件，并做一些配置</li> <li>安装<code>webpack</code>和<code>webpack-cli</code></li> <li>安装<code>ts-loader</code>和<code>typescript</code></li></ul></div> <p><strong>整体目录：</strong> 按以上步骤运行后，项目目录大概如下所示</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> src
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>ts
<span class="token operator">|</span><span class="token operator">--</span> tsconfig<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
</code></pre></div><p><strong>package.json文件：</strong> 添加好命令和安装好依赖后，结构可能如下所示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack-typescript&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;version&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;description&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;main&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;scripts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;build&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;keywords&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;author&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;license&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;devDependencies&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ts-loader&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^5.3.3&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;typescript&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^3.4.1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^4.29.6&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;webpack-cli&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^3.3.0&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>webpack.config.js：</strong> 想要进行 Webpack的配置，需要进行如下配置：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.(ts|tsx)?$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> <span class="token string">'ts-loader'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    main<span class="token punctuation">:</span> <span class="token string">'./src/index.ts'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>tsconfig.json文件：</strong> 在里面进行<code>typescript</code>的相关配置，配置项的说明如下</p> <ul><li><code>module</code>: 表示我们使用<code>ES6</code>模块</li> <li><code>target</code>: 表示我们转换成<code>ES5</code>代码</li> <li><code>allowJs</code>: 允许我们在<code>.ts</code>文件中通过<code>import</code>语法引入其他<code>.js</code>文件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;compilerOptions&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;module&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ES6&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;target&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ES5&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;allowJs&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>index.ts文件代码：</strong> 在此文件中书写<code>TypeScript</code>代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Greeter</span> <span class="token punctuation">{</span>
  greeting<span class="token punctuation">:</span> string
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>greeting <span class="token operator">=</span> message<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'hello, '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>greeting<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> greeter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Greeter</span><span class="token punctuation">(</span><span class="token string">'why'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greeter<span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="打包测试"><a href="#打包测试" aria-hidden="true" class="header-anchor">#</a> 打包测试</h4> <ul><li>运行<code>npm run build</code>进行打包</li> <li>在生成<code>dist</code>目录下，新建<code>index.html</code>，并引入打包后的<code>main.js</code>文件</li> <li>在浏览器中运行<code>index.html</code> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAugAAABoCAYAAACjdQVhAAAgAElEQVR4nO2dC9AUxbmGm4AKAiIgSkSRCCoaSLDAEjEiXiGKljESkVQ0EaKcWHg5lkaCR2MiYqRMeUtERQ3Ea/AWsVQsMRoNRsUrqARQEYSgEZGbKIafk6fP+dZmmN2d3Z3dnZ//faq2dnd2Lj3dX3e//fXXs80aGho2OSGEEEIIIUQm+Fq9EyCEEEIIIYT4Cgl0IYQQQgghMoQEuhBCCCGEEBlCAl0IIYQQQogMIYEuhBBCCCFEhmjx+uuv1zsNQgghhBBCiP+n2erVq/WYRSGEEEIIITKCQlyEEEIIIYTIEBLoQgghhBBCZAgJdCGEEEIIITKEBLoQQgghhBAZokW9E1CIW265xS1atCjRvt/4xjfcqFGjEp/7H//4h9tnn33KTJkQQgghhBDVIdMCHXE+fvz4RPuOGzeuyqkRQgghhBCi+iQW6A888IB77bXX3MaNGwvut80227j+/fu7IUOGVJw4IYQQQgghmhqJBTri/Fe/+lWifX/5y19KoAshhBBCCFEGiReJFvOch3z55ZdlJaax8tZbb7kzzzwz97r++uvdhg0b3JIlS9zkyZP956bOzTff7AYNGuRfv/71r90XX3xRs2uvWrXKX5P3eoENYBdmI0899VTd0lIvqCfnn3++rxch5AW/1ZN61dVo23HXXXdVdB5re8SW5LM/YNsll1wS+9vWDvly6aWXutWrV6dyPuqztW/YcxptHWm76qqrMl0+9WjjyQ/yJa2yS5M07KoattSYyFwMenRhqMWWl7oItNYceuihbsSIEfVOxhZQSZj9qFfaEMUXXXSRO+6449zTTz/tt73//vu+jJvSIt377rvPffOb33Rjxozx32fNmuUb9G233bbOKastnTp1cg899JDvwEq5d/Jq6tSpbvDgwW733XevYgprT9h2WCd0+OGHJz6evMGeLr744q0ub9IG+1uwYMEW+fTSSy+57bffvk6pqi/z5s3z+TF79uyS7C4JlfQ71IU+ffq4/fbbz+2www7uwgsvTDFl6VOPNp5ys3zJWhuZtl2FthTaxtZMVR6zmHRhZxz5ntry3nvvlX1OUT/+9re/eXF+zDHH5LbtscceTUqcw2effeb22muv3PcBAwY0OXEOXbt2dR07dnQLFy6sd1IyCZ3O8uXL652MrZbWrVu7N998czOvHp8///xzb5tNDbv3ww47zL377ruafakAtfFfIbtKh4o86DfddJNr166d6969u+vRo4dr3759KomKE/hbw1NaGPU988wz/vPJJ5/sR5VMUc2YMcPtuuuu7s9//rPr1auXO+WUU/xUGR116F3DyMnzuXPn+u/nnHOOH0HicaMyvPPOO/43zoGHEhF07bXX+n1ffvlld+6553rv0b333uu31cLrz+MsTzzxxLy/403HA/Dhhx/679dcc40XKXjer7vuOnfIIYf4NQ3R3/DKv/32226XXXbxU3yI/nznKnTNfffd11155ZXejqvJnnvu6UMomGLHGxSCDZDWtWvX+u9WrmYbp556qm/ow++knc92POclX+w8nTt3zl0rzu5oQK+++mpvY23atPG2USuvC2V69913u912222LvIBoer/zne/k7B5PJ3YL5kHh/jnf6NGj/fmoD9w/v4XnsnpBXrLPp59+6l5//XU/WCRNhpXHsccem7pHsRQK1XdLO+0uny1vrHxLue8k7U80LVGvf7du3fx5om1WaNvFbLIWMDiEDz74IOd9w8O34447umXLluX2y5f3pbTX+eo1dW/KlCmuS5cu3oGBkCPkLzwOe66Fx5h8oFys7tOu2OdouUbtKOxzwrINCT2dcXlKG2DtEETtlxfXJW/Ydtppp/lrFMvbvn37+vfwt2qTtI0P8youTyCc9Q5nwfPV3+HDh7vbb7891w4cdNBB7qOPPvK2GZYn165FXctnV1Evf/R72C9x/Le//W1fNy392BJ5EdoGNvncc8/VVNfUiooE+k477eReeeUVN2fOHP+9bdu2vkKnLdgbA2YwEGcgZlzW2WGUNtpGaFK5qajsR2NPBYZJkyb5yo0Q5ZgTTjjBT6FZQ0QDBzNnzvQiC2PlPIhzGiUqvFVujsF7NHHixFhhVA1okKyCRUEoT5gwISewEZhXXHGFtxvrMOfPn+9DY7iH6dOne0FtXvkbb7wx8bnC/XgiEXm53Xbb+fNSsc8444yq5gONIg3OBRdcsFlHR9kS1mUCmTKizKlLxcBuRo4cmeuY6NSjQjuf3TFQw07rIUBJX79+/dwjjzySuJ6QX2FDTkdFI869cy8NDQ2+U6DdwWPDMRbPTX0AjmEa2q5JJ2cdpcW25svHWsD9Uo+POOKI3L3nq+9h2qOdXKn3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IUSGkEAXQgghhBAiQ2iRqBBNDC30FUIIUSl6WEJ1kUAXogmyalibeidBCCFEI6XdtLX1TsJWT5MNcdFTOERaZNGWspgmIYQQQiSjyQp0IYQQQgghskjREJdx48aVffLx48eXfWzIokWL3AsvvODf161b51q3bu26devm+vfv7/bYY49UriFEvdi0aZNbsWKF+/TTT/33HXfc0XXs2NE1a9aszikTQgixtbN27Vr3ySefuM8++8z9+9//di1atHDbb7+974fQW6I+JIpBD4U2gj2J8K5E2BsNDQ3ukUce8eLcwHBWr17t3njjDf9CpB977LHua1/TZIBoXDDYfOaZZ9xrr73mP4fQKO6///7u0EMP9Q2lEEIIkSY4h/75z396B1HIl19+6VatWuVfHTp0cLvuuqscRnUg04tEQ3F++OGHu4MOOsiLFUZ7r7zyinvqqafc3//+d//7cccdV8+kClES8+bNc/fdd59bv369/04juOeee/rP77zzjlu5cqV77rnn3Msvv+yGDRvm9tlH/+AqhBAiPeLEeRQ869ClS5eSz//WW2+5a6+9drNt55xzjttvv/2KHrthwwZ30003ublz5yY+JmTJkiVuxowZ7tRTT3Xbbrtt3v1w+E6ZMsWddtppbocddijpGoW46667XJ8+fUpOd0hFAh1xfOCBB1ZlZGVhLQaFxLWgTZs2buDAgT7M5bbbbvPp+Na3vlW1cJc0MlpkFyrn/Pnzt9iOKKZypw0zP3/605+89wKYBTrmmGNc8+bN/XemGB999FFv/wj4O+64w5188smuV69eqaclLd5//30/oB41apTbbrvtcttvv/1217dvX18/q83jjz/u34cMGeLfv/jiCzd58mQ3dOhQP5hPOx3hPS9fvjz2/tMGj9bll1/uli1b5r///Oc/z90TdvWb3/zGfz7yyCPdT37yk6LHUD5PPvmk/0wbd/bZZ2+Wfo69+eab3RlnnOHatWuX+r1cc8017sc//nEmQxWj9lTpuRBDViZC1BtmbU2c77zzzt5rjmPIaN++vdtmm23cRx995EU638uZzWUWeMSIEf4zYvjqq6/223C6FmLhwoU+xAaRXimI/alTp7rBgwe73XffveLzVYM4HVJRXMj06dN94/2vf/2rooTFYeL8sMMO88aDkdx6663ee2507drVe9XBPOlClAoCjtCpEMQy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" alt="打包结果"></li></ul> <h4 id="使用其他模块的类型定义文件"><a href="#使用其他模块的类型定义文件" aria-hidden="true" class="header-anchor">#</a> 使用其他模块的类型定义文件</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>如果我们要使用<code>lodash</code>库，必须在<code>@types/xxx</code>下安装其对应的类型定义文件</p></div> <p><strong>改写index.ts：</strong> 在安装<code>npm install @types/lodash -D</code>后，引入<code>lodash</code>，并使用里面的方法</p> <div class="language-js extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span>

<span class="token keyword">class</span> <span class="token class-name">Greeter</span> <span class="token punctuation">{</span>
  greeting<span class="token punctuation">:</span> string
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>greeting <span class="token operator">=</span> message<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>greeting<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'**'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> greeter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Greeter</span><span class="token punctuation">(</span><span class="token string">'why'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greeter<span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="打包测试-2"><a href="#打包测试-2" aria-hidden="true" class="header-anchor">#</a> 打包测试</h4> <p><img src="data:image/png;base64,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pEUWy1IW4ySEEEKI8miygl0IIYQQQojGQFGXmDFjxpQd+NixY8u+NmTRokXu5Zdf9t/r1q1zrVq1cl26dHF9+/Z1e+21Vyr3EKJebN682a1YscJ9+umnfnunnXZy7du3d82aNatzzIQQQmztrF271n3yySfus88+c//+979d8+bN3Q477OD7IfSWyAaJfNhD4Y2ATyLEKxH6xqZNm9zjjz/uxbpBQVq9erV78803/QfRfsIJJ7ivfU2TBaJxweDz+eefd2+88Yb/HUIjedBBB7kjjjjCN5xCCCFEmmAs+uc//+kNRiFffvmlW7Vqlf/svPPObvfdd5cBKQNketFpKNaPOuood+ihh3rxwmjw9ddfd88++6z729/+5o+feOKJ9YyqECUxb94898ADD7j169f7bRrFvffe2/9+55133MqVK92LL77oXnvtNTdkyBC33376h1khhBDpESfWo2B5h06dOpUc/ltvveWuu+66BvsuuOACd8ABBxS9dsOGDe7WW291c+bMSXxNyJIlS9y0adPcGWec4bbbbru852EAnjx5sjvzzDPdjjvuWNI9CnHPPfe4Xr16lRzvQlQk2BHLhxxySFVGXuYGY5Bp3Atat27t+vfv791ifve73/l4fPOb36yae0w1El5kByrr/Pnzt9iPSKaypw0zQ3/84x+9dQOYJTr++OPdNtts47eZknziiSd8+UfQ33XXXe60005zPXr0SD0uafH+++/7AfaIESPc9ttvn9t/5513ut69e/v6WW2eeuop/z1o0CD//cUXX7hJkya5wYMH+8F92vEIn3n58uWxz582WLyuuuoqt2zZMr/905/+NPdMlKtf/epX/vcxxxzjfvSjHxW9hvx55pln/G/auPPPP79B/Ln2tttuc2effbZr27Zt6s9y7bXXuh/+8IeZdG2MlqdKw0IcWZ4IUW+Y1TWxvuuuu3qrOoYio127dm7bbbd1H330kRftbJcz28ss8bBhw/xvxPE111zj92GELcTChQu9Sw6ivVIQ/1OmTHEDBw50e+65Z8XhVYMkOqQiP5LHHnvMN+b/+te/KgkmFhPrRx55pC9MFJo77rjDW9eNzp07e6s7mKVdiFJB0OFqFYJ4RkSnzccff+weeuihnFhnqhGXLsQWoorP7NmzfZw4BriGYY0vZglpbCAWeW6D3+wrB8Qf6WbtAfCmHDqY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" alt="打包结果"></p> <h3 id="webpackdevserver请求转发"><a href="#webpackdevserver请求转发" aria-hidden="true" class="header-anchor">#</a> WebpackDevServer请求转发</h3> <p>在这一小节中，我们要学到的技能有：</p> <ul><li>如何进行接口代理配置</li> <li>如何使用接口路径重写</li> <li>其他常见配置的含义</li></ul> <p>假设我们现在有这样一个需求：我有一个URL地址(<code>http://www.dell-lee.com/react/api/header.json</code>)，我希望我请求的时候，请求的地址是<code>/react/api/header.json</code>，能有一个什么东西能自动帮我把请求转发到<code>http://www.dell-lee.com</code>域名下，那么这个问题该如何解决呢？</p> <div class="tip custom-block"><p class="custom-block-title">解决办法</p> <p>可以使用 Webpack 的<code>webpack-dev-server</code>这个插件来解决，其中需要配置<code>proxy</code>属性。</p></div> <h4 id="如何进行接口代理配置"><a href="#如何进行接口代理配置" aria-hidden="true" class="header-anchor">#</a> 如何进行接口代理配置</h4> <p>既然我们要做请求，那么安装<code>axios</code>来发请求再合适不过了，使用如下命令安装<code>axios</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code>$ npm install axios <span class="token operator">--</span>save<span class="token operator">-</span>dev
</code></pre></div><p><strong>webpack.dev.js代码：</strong> 因为我们的请求代理只能在开发环境下使用，线上的生产环境，需要走其他的代理配置，所以我们需要在<code>webpack.dev.js</code>中进行代理配置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> devConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 其他配置</span>
  devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 启动bundle文件夹</span>
    contentBase<span class="token punctuation">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>
    <span class="token comment">// 自动打开浏览器</span>
    open<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token comment">// 端口3000</span>
    port<span class="token punctuation">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
    <span class="token comment">// 模块热更新</span>
    hot<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    hotOnly<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 请求代理</span>
    proxy<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">'/react/api'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">:</span> <span class="token string">'http://www.dell-lee.com'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>改写index.js代码：</strong> 在<code>index.js</code>文件中，引入<code>axios</code>模块，再做请求转发。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span>

axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/react/api/header.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span>data<span class="token punctuation">,</span>status<span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>请求的结果：</strong> 可以看到，我们已经成功请求到了我们的数据。
<img src="/blog/assets/img/27.800bf85f.png" alt="请求的结果"></p> <h4 id="如何使用接口路径重写"><a href="#如何使用接口路径重写" aria-hidden="true" class="header-anchor">#</a> 如何使用接口路径重写</h4> <p>现在依然假设有这样一个场景：<code>http://www.dell-lee.com/react/api/header.json</code>这个后端接口还没有开发完毕，但后端告诉我们可以先使用<code>http://www.dell-lee.com/react/api/demo.json</code> 这个测试接口，等接口开发完毕后，我们再改回来。</p> <div class="tip custom-block"><p class="custom-block-title">解决办法</p> <p>解决这个问题最佳办法是，代码中的地址不能变动，我们只在<code>proxy</code>代理中处理即可，使用<code>pathRewrite</code>属性进行配置。</p></div> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> devConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 其他配置</span>
  devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 启动bundle文件夹</span>
    contentBase<span class="token punctuation">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>
    <span class="token comment">// 自动打开浏览器</span>
    open<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token comment">// 端口3000</span>
    port<span class="token punctuation">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
    <span class="token comment">// 模块热更新</span>
    hot<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    hotOnly<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 请求代理</span>
    proxy<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">'/react/api'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">:</span> <span class="token string">'http://www.dell-lee.com'</span><span class="token punctuation">,</span>
        pathRewrite<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          <span class="token string">'header.json'</span><span class="token punctuation">:</span> <span class="token string">'demo.json'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>请求结果：</strong> 我们可以看到，我们的测试接口的数据已经成功拿到了。
<img src="/blog/assets/img/28.0b314363.png" alt="请求结果"></p> <h4 id="其他常见配置的含义"><a href="#其他常见配置的含义" aria-hidden="true" class="header-anchor">#</a> 其他常见配置的含义</h4> <p><strong>转发到https：</strong> 一般情况下，不接受运行在<code>https</code>上，如果要转发到<code>https</code>上，可以使用如下配置</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//... 其他配置</span>
  devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    proxy<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">'/react/api'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">:</span> <span class="token string">'https://www.dell-lee.com'</span><span class="token punctuation">,</span>
        secure<span class="token punctuation">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>跨域：</strong> 有时候，在请求的过程中，由于同源策略的影响，存在跨域问题，我们需要处理这种情况，可以如下进行配置。</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//... 其他配置</span>
  devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    proxy<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">'/react/api'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">:</span> <span class="token string">'https://www.dell-lee.com'</span><span class="token punctuation">,</span>
        changeOrigin<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>代理多个路径到同一个target：</strong> 代理多个路径到同一个<code>target</code>，可以如下进行配置</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//... 其他配置</span>
  devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    proxy<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      context<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'/vue/api'</span><span class="token punctuation">,</span> <span class="token string">'/react/api'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      target<span class="token punctuation">:</span> <span class="token string">'http://www.dell-lee.com'</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="多页打包"><a href="#多页打包" aria-hidden="true" class="header-anchor">#</a> 多页打包</h3> <p>现在流行的前端框架都推行单页引用(SPA)，但有时候我们不得不兼容一些老的项目，他们是多页的，那么如何进行多页打包配置呢？
现在我们来思考一个问题：多页运用，即 <strong>多个入口文件+多个对应的html文件</strong> ，那么我们就可以配置 <strong>多个入口+配置多个<code>html-webpack-plugin</code></strong> 来进行。</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>假设现在我们有这样三个页面：<code>index.html</code>, <code>list.html</code>, <code>detail.html</code>，我们需要配置三个入口文件，新建三个<code>.js</code>文件。</p></div> <p><strong>配置多入口+生成多个页面：</strong> 在<code>webpack.common.js</code>中配置多个<code>entry</code>并使用<code>html-webpack-plugin</code>来生成对应的多个<code>.html</code>页面，具体如下：</p> <div class="tip custom-block"><p class="custom-block-title">HtmlWebpackPlugin参数说明</p> <ul><li><code>template</code>：代表以哪个HTML页面为模板</li> <li><code>filename</code>：代表生成页面的文件名</li> <li><code>chunks</code>：代表需要引用打包后的哪些<code>.js</code>文件</li></ul></div> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 其他配置</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    index<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    list<span class="token punctuation">:</span> <span class="token string">'./src/list.js'</span><span class="token punctuation">,</span>
    detail<span class="token punctuation">:</span> <span class="token string">'./src/detail.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token punctuation">:</span> <span class="token string">'src/index.html'</span><span class="token punctuation">,</span>
      filename<span class="token punctuation">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span>
      chunks<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token punctuation">:</span> <span class="token string">'src/index.html'</span><span class="token punctuation">,</span>
      filename<span class="token punctuation">:</span> <span class="token string">'list.html'</span><span class="token punctuation">,</span>
      chunks<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'list'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token punctuation">:</span> <span class="token string">'src/index.html'</span><span class="token punctuation">,</span>
      filename<span class="token punctuation">:</span> <span class="token string">'detail.html'</span><span class="token punctuation">,</span>
      chunks<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'detail'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">cleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>新建三个js文件：</strong> 在<code>src</code>目录下新建三个<code>.js</code>文件，名字分别是：<code>index.js</code>，<code>list.js</code>和<code>detail.js</code>，它们的代码如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js代码</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'this is index page!'</span>

<span class="token comment">// list.js代码</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'this is list page!'</span>

<span class="token comment">// detail.js代码</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'this is detail page!'</span>
</code></pre></div><p>运行<code>npm run build</code>进行打包：</p> <div class="language-js extra-class"><pre class="language-js"><code>$ npm run build
</code></pre></div><p>打包后的<code>dist</code>目录：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> dist
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> detail<span class="token punctuation">.</span>dae2986ea47c6eceecd6<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> detail<span class="token punctuation">.</span>dae2986ea47c6eceecd6<span class="token punctuation">.</span>js<span class="token punctuation">.</span>map
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> detail<span class="token punctuation">.</span>html
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>ca8e3d1b5e23e645f832<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>ca8e3d1b5e23e645f832<span class="token punctuation">.</span>js<span class="token punctuation">.</span>map
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> list<span class="token punctuation">.</span><span class="token number">5</span>f40def0946028db30ed<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> list<span class="token punctuation">.</span><span class="token number">5</span>f40def0946028db30ed<span class="token punctuation">.</span>js<span class="token punctuation">.</span>map
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> list<span class="token punctuation">.</span>html
</code></pre></div><p>随机选择<code>list.html</code>在浏览器中运行，结果如下：
<img src="/blog/assets/img/29.70cef326.png" alt="运行结果"></p> <div class="tip custom-block"><p class="custom-block-title">思考</p> <p>现在只有三个页面，即我们要配置三个入口+三个对应的<code>html</code>，如果我们有十个入口，那么我们也要这样做重复的劳动吗？有没有什么东西能帮助我们自动实现呢？答案当然是有的！</p></div> <p>我们首先定义一个<code>makePlugins</code>方法，它接受一个 Webpack 配置项的参数：<code>configs</code>，返回一个<code>plugins</code>数组</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">makePlugins</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">configs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">cleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
  <span class="token comment">// 根据入口的多少来进行循环</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>configs<span class="token punctuation">.</span>entry<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        template<span class="token punctuation">:</span> <span class="token string">'src/index.html'</span><span class="token punctuation">,</span>
        filename<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.html`</span></span><span class="token punctuation">,</span>
        chunks<span class="token punctuation">:</span> <span class="token punctuation">[</span>key<span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> plugins<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过调用<code>makePlugins</code>方法，接受一个<code>plugins</code>数组，把它赋值给 Webpack 配置<code>configs</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code>configs<span class="token punctuation">.</span>plugins <span class="token operator">=</span> <span class="token function">makePlugins</span><span class="token punctuation">(</span>configs<span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> configs<span class="token punctuation">;</span>
</code></pre></div><p><code>webpack.commom.js</code>完整的代码如下：</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>打包结果依然还是一样的，请自行测试。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> htmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cleanWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> configs <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    index<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    list<span class="token punctuation">:</span> <span class="token string">'./src/list.js'</span><span class="token punctuation">,</span>
    detail<span class="token punctuation">:</span> <span class="token string">'./src/detail.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> 
        test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span> 
        exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">makePlugins</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">configs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">cleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>configs<span class="token punctuation">.</span>entry<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        template<span class="token punctuation">:</span> <span class="token string">'src/index.html'</span><span class="token punctuation">,</span>
        filename<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.html`</span></span><span class="token punctuation">,</span>
        chunks<span class="token punctuation">:</span> <span class="token punctuation">[</span>key<span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> plugins<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
configs<span class="token punctuation">.</span>plugins <span class="token operator">=</span> <span class="token function">makePlugins</span><span class="token punctuation">(</span>configs<span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> configs<span class="token punctuation">;</span>
</code></pre></div><h2 id="webpack性能优化"><a href="#webpack性能优化" aria-hidden="true" class="header-anchor">#</a> Webpack性能优化</h2> <h3 id="打包分析"><a href="#打包分析" aria-hidden="true" class="header-anchor">#</a> 打包分析</h3> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>在进行 Webpack 性能优化之前，我们有必要知道我们打包的文件到底有多大，打包时间是多少，我们使用<code>webpack-bundle-analyzer</code>来帮助我们</p></div> <p><strong>安装打包分析插件：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>$ npm install webpack<span class="token operator">-</span>bundle<span class="token operator">-</span>analyzer <span class="token operator">--</span>save<span class="token operator">-</span>dev
</code></pre></div><p><strong>改写webpack.prod.js配置：</strong> 在<code>webpack.prod.js</code>文件中添加<code>webpack-bundle-analyzer</code>插件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> BundleAnalyzerPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-bundle-analyzer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BundleAnalyzerPlugin<span class="token punctuation">;</span>
<span class="token keyword">const</span> prodConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 其它配置项</span>
  mode<span class="token punctuation">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>打包结果：</strong> 运行<code>npm run build</code>命令来查看打包分析结果
<img src="/blog/assets/img/30.ec596926.png" alt="打包分析结果"></p> <h3 id="缩小文件的搜索范围"><a href="#缩小文件的搜索范围" aria-hidden="true" class="header-anchor">#</a> 缩小文件的搜索范围</h3> <div class="tip custom-block"><p class="custom-block-title">理解</p> <p>首先我们要弄明白 Webpack 的一个配置参数(<code>Resolve</code>)的作用：它告诉了 Webpack 怎么去搜索文件，它同样有几个属性需要我们去理解：</p> <ul><li><code>extensions</code>：它告诉了 Webpack 当我们在导入模块，但没有写模块的后缀时应该如何去查找模块。</li> <li><code>mainFields</code>：它告诉了 Webpack 当我们在导入模块，但并没有写模块的具体名字时，应该如何去查找这个模块。</li> <li><code>alias</code>：当我们有一些不得不引用的第三方库或者模块的时候，可以通过配置别名，直接引入它的<code>.min.js</code>文件，这样可以库内的直接解析</li> <li>其它<code>include</code>、<code>exclude</code>、<code>test</code>来配合loader进行限制文件的搜索范围</li></ul></div> <h4 id="extensions参数"><a href="#extensions参数" aria-hidden="true" class="header-anchor">#</a> extensions参数</h4> <p>就像上面所说的那样，<code>extensions</code>它告诉了 Webpack 当我们在导入模块，但没有写模块的后缀时，应该如何去查找模块。这种情况在我们开发中是很常见的，一个情形可能如下所示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 书写了模块后缀</span>
<span class="token keyword">import</span> main <span class="token keyword">from</span> <span class="token string">'main.js'</span>

<span class="token comment">// 没有书写模块后缀</span>
<span class="token keyword">import</span> main <span class="token keyword">from</span> <span class="token string">'main'</span>
</code></pre></div><p>像上面那样，我们不写<code>main.js</code>的<code>.js</code>后缀，是因为 Webpack 会默认帮我们去查找一些文件，我们也可以去配置自己的文件后缀配置：</p> <div class="warning custom-block"><p class="custom-block-title">注意</p> <p><code>extensions</code>参数应尽可能只配置主要的文件类型，不可为了图方便写很多不必要的，因为每多一个，底层都会走一遍文件查找的工作，会损耗一定的性能。</p></div> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 其他配置</span>
  resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.json'</span><span class="token punctuation">,</span> <span class="token string">'.vue'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果我们像上面配置后，我们可以在代码中这样写：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 省略 .vue文件扩展</span>
<span class="token keyword">import</span> BaseHeader <span class="token keyword">from</span> <span class="token string">'@/components/base-header'</span><span class="token punctuation">;</span>

<span class="token comment">// 省略 .json文件扩展</span>
<span class="token keyword">import</span> CityJson <span class="token keyword">from</span> <span class="token string">'@/static/city'</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="mainfields参数"><a href="#mainfields参数" aria-hidden="true" class="header-anchor">#</a> mainFields参数</h4> <p><code>mainFields</code>参数主要应用场景是，我们可以不写具体的模块名称，由 Webpack 去查找，一个可能的情形如下:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 省略具体模块名称</span>
<span class="token keyword">import</span> BaseHeader <span class="token keyword">from</span> <span class="token string">'@components/base-header/'</span><span class="token punctuation">;</span>

<span class="token comment">// 以上相当于这一段代码</span>
<span class="token keyword">import</span> BaseHeader <span class="token keyword">from</span> <span class="token string">'@components/base-header/index.vue'</span><span class="token punctuation">;</span>
<span class="token comment">// 或者这一段</span>
<span class="token keyword">import</span> BaseHeader <span class="token keyword">from</span> <span class="token string">'@components/base-header/main.vue'</span><span class="token punctuation">;</span>
</code></pre></div><p>我们也可以去配置自己的<code>mainFields</code>参数：</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>同<code>extensions</code>参数类似，我们也不建议过多的配置<code>mainFields</code>的值，原因如上。</p></div> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 其他配置</span>
  resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.json'</span><span class="token punctuation">,</span> <span class="token string">'.vue'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    mainFields<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">,</span> <span class="token string">'index'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="alias参数"><a href="#alias参数" aria-hidden="true" class="header-anchor">#</a> alias参数</h4> <p><code>alias</code>参数更像一个别名，如果你有一个目录很深、文件名很长的模块，为了方便，配置一个别名这是很有用的；对于一个庞大的第三方库，直接引入<code>.min.js</code>而不是从<code>node_modules</code>中引入也是一个极好的方案，一个可能得情形如下：</p> <div class="warning custom-block"><p class="custom-block-title">注意</p> <p>通过别名配置的模块，会影响<code>Tree Shaking</code>，建议只对整体性比较强的库使用，像<code>lodash</code>库不建议通过别名引入，因为<code>lodash</code>使用<code>Tree Shaking</code>更合适。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 没有配置别名之前</span>
<span class="token keyword">import</span> main <span class="token keyword">from</span> <span class="token string">'src/a/b/c/main.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// 配置别名之后</span>
<span class="token keyword">import</span> main <span class="token keyword">from</span> <span class="token string">'main.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 别名配置</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 其他配置</span>
  resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.json'</span><span class="token punctuation">,</span> <span class="token string">'.vue'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    mainFields<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">,</span> <span class="token string">'index'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    alias<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      main<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src/a/b/c'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      react<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./node_modules/react/dist/react.min.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="tree-shaking去掉冗余的代码"><a href="#tree-shaking去掉冗余的代码" aria-hidden="true" class="header-anchor">#</a> Tree Shaking去掉冗余的代码</h3> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Tree Shaking配置我们已经在上面讲过，配置Tree Shaking也很简单。</p></div> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 其他配置</span>
  optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    usedExports<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="dllplugin减少第三方库的编译次数"><a href="#dllplugin减少第三方库的编译次数" aria-hidden="true" class="header-anchor">#</a> DllPlugin减少第三方库的编译次数</h3> <p>对于有些固定的第三方库，因为它是固定的，我们每次打包，Webpack 都会对它们的代码进行分析，然后打包。那么有没有什么办法，让我们只打包一次，后面的打包直接使用第一次的分析结果就行。答案当然是有的，我们可以使用 Webpack 内置的<code>DllPlugin</code>来解决这个问题，解决这个问题可以分如下的步骤进行：</p> <ul><li>把第三方库单独打包在一个<code>xxx.dll.js</code>文件中</li> <li>在<code>index.html</code>中使用<code>xxx.dll.js</code>文件</li> <li>生成第三方库的打包分析结果保存在<code>xxx.manifest.json</code>文件中</li> <li>当<code>npm run build</code>时，引入已经打包好的第三方库的分析结果</li> <li>优化</li></ul> <h4 id="单独打包第三方库"><a href="#单独打包第三方库" aria-hidden="true" class="header-anchor">#</a> 单独打包第三方库</h4> <div class="tip custom-block"><p class="custom-block-title">步骤</p> <p>为了单独打包第三方库，我们需要进行如下步骤：</p> <ul><li>根目录下生成<code>dll</code>文件夹</li> <li>在<code>build</code>目录下生成一个<code>webpack.dll.js</code>的配置文件，并进行配置。</li> <li>在<code>package.json</code>文件中，生成<code>build:dll</code>命令</li> <li>使用<code>npm run build:dll</code>进行打包</li></ul></div> <p>生成<code>dll</code>文件夹：</p> <div class="language-js extra-class"><pre class="language-js"><code>$ mkdir dll
</code></pre></div><p>在<code>build</code>文件夹下生层<code>webpack.dll.js</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code>$ cd build
$ touch webpack<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>js
</code></pre></div><p><code>webpack.dll.js</code>文件的代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    vendors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'lodash'</span><span class="token punctuation">,</span> <span class="token string">'jquery'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'[name].dll.js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    library<span class="token punctuation">:</span> <span class="token string">'[name]'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>package.json</code>文件中的打包命令</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token comment">// ... 其他配置</span>
  <span class="token string">&quot;scripts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;dev&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack-dev-server --config ./build/webpack.dev.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;build&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack --config ./build/webpack.prod.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;report&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack --profile --json &gt; stats.json --config ./build/webpack.prod.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;build:dll&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack --config ./build/webpack.dll.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用<code>npm run build:dll</code>打包结果：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> build
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>common<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> dll
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> vendors<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> src
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
</code></pre></div><h4 id="引用xxx-dll-js文件"><a href="#引用xxx-dll-js文件" aria-hidden="true" class="header-anchor">#</a> 引用<code>xxx.dll.js</code>文件</h4> <p>要在<code>index.html</code>中引入其他的文件，需要安装<code>add-asset-html-webpack-plugin</code>插件：</p> <div class="language-js extra-class"><pre class="language-js"><code>$ npm install add<span class="token operator">-</span>asset<span class="token operator">-</span>html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p>在<code>webpack.common.js</code>中使用<code>add-asset-html-webpack-plugin</code>插件：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> htmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cleanWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> addAssetHtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'add-asset-html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> configs <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 其他配置</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">cleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token punctuation">:</span> <span class="token string">'src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">addAssetHtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filepath<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll/vendors.dll.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> configs<span class="token punctuation">;</span>
</code></pre></div><p>我们将第三方库全局暴露了一个<code>vendors</code>变量，现引入<code>xxx.dll.js</code>文件结果如下所示：
<img src="/blog/assets/img/29.70cef326.png" alt="引用结果"></p> <h4 id="生成打包分析文件"><a href="#生成打包分析文件" aria-hidden="true" class="header-anchor">#</a> 生成打包分析文件</h4> <p>在<code>webpack.dll.js</code>中使用 Webpack 内置的<code>DllPlugin</code>插件，进行打包分析：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    vendors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'lodash'</span><span class="token punctuation">,</span> <span class="token string">'jquery'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'[name].dll.js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    library<span class="token punctuation">:</span> <span class="token string">'[name]'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'[name]'</span><span class="token punctuation">,</span>
      path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll/[name].manifest.json'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="引用打包分析文件"><a href="#引用打包分析文件" aria-hidden="true" class="header-anchor">#</a> 引用打包分析文件</h4> <p>在<code>webpack.common.js</code>中使用 Webpack 内置的<code>DllReferencePlugin</code>插件来引用打包分析文件：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> htmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cleanWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> addAssetHtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'add-asset-html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 其他配置</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">cleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token punctuation">:</span> <span class="token string">'src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">addAssetHtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filepath<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll/vendors.dll.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      manifest<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll/vendors.manifest.json'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="优化"><a href="#优化" aria-hidden="true" class="header-anchor">#</a> 优化</h4> <p>现在我们思考一个问题，我们目前是把<code>lodash</code>和<code>jquery</code>全部打包到了<code>vendors</code>文件中，那么如果我们要拆分怎么办，拆分后又改如何去配置引入？一个可能的拆分结果如下：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    vendors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'lodash'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    jquery<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'jquery'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'[name].dll.js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    library<span class="token punctuation">:</span> <span class="token string">'[name]'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'[name]'</span><span class="token punctuation">,</span>
      path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll/[name].manifest.json'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>根据上面的拆分结果，我们需要在<code>webpack.common.js</code>中进行如下的引用配置：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> htmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cleanWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> addAssetHtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'add-asset-html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> configs <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 其他配置</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">cleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token punctuation">:</span> <span class="token string">'src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">addAssetHtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filepath<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll/vendors.dll.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token keyword">new</span> <span class="token class-name">addAssetHtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filepath<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll/jquery.dll.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      manifest<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll/vendors.manifest.json'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      manifest<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll/jquery.manifest.json'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> configs<span class="token punctuation">;</span>
</code></pre></div><p>我们可以发现：随着我们引入的第三方模块越来越多，我们不断的要进行 Webpack 配置文件的修改。对于这个问题，我们可以使用<code>Node</code>的核心模块<code>fs</code>来分析<code>dll</code>文件夹下的文件，进行动态的引入，根据这个思路我们新建一个<code>makePlugins</code>方法，它返回一个 Webpack 的一个<code>plugins</code>数组：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">makePlugins</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">cleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token punctuation">:</span> <span class="token string">'src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// 动态分析文件</span>
  <span class="token keyword">const</span> files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">file</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果是xxx.dll.js文件</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token regex">/.*\.dll.js/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">addAssetHtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          filepath<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll'</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 如果是xxx.manifest.json文件</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token regex">/.*\.manifest.json/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          manifest<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll'</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> plugins<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
configs<span class="token punctuation">.</span>plugins <span class="token operator">=</span> <span class="token function">makePlugins</span><span class="token punctuation">(</span>configs<span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> configs<span class="token punctuation">;</span>
</code></pre></div><p>使用<code>npm run build:dll</code>进行打包第三方库，再使用<code>npm run build</code>打包，打包结果如下:</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>本次试验，第一次打包时间为1100ms+，后面的打包稳定在800ms+，说明我们的 Webpack性能优化已经生效。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> build
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>common<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> dist
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> jquery<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> main<span class="token punctuation">.</span><span class="token number">1158</span>fa9f961c50aaea21<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> main<span class="token punctuation">.</span><span class="token number">1158</span>fa9f961c50aaea21<span class="token punctuation">.</span>js<span class="token punctuation">.</span>map
<span class="token operator">|</span><span class="token operator">--</span> dll
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> jquery<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> jquery<span class="token punctuation">.</span>manifest<span class="token punctuation">.</span>json
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> vendors<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> vendors<span class="token punctuation">.</span>manifest<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> postcss<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> src
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>js
</code></pre></div><h3 id="happypack插件开启多线程打包"><a href="#happypack插件开启多线程打包" aria-hidden="true" class="header-anchor">#</a> HappyPack插件开启多线程打包</h3> <h3 id="uglifyjs插件压缩代码"><a href="#uglifyjs插件压缩代码" aria-hidden="true" class="header-anchor">#</a> UglifyJS插件压缩代码</h3> <h2 id="编写自己的loader"><a href="#编写自己的loader" aria-hidden="true" class="header-anchor">#</a> 编写自己的Loader</h2> <p>在我们使用 Webpack 的过程中，我们使用了很多的<code>loader</code>，那么那些<code>loader</code>是哪里来的？我们能不能写自己的<code>loader</code>然后使用？
答案当然是可以的，Webpack 为我们提供了一些<code>loader</code>的API，通过这些API我们能够编写出自己的<code>loader</code>并使用。</p> <h3 id="如何编写及使用自己的loader"><a href="#如何编写及使用自己的loader" aria-hidden="true" class="header-anchor">#</a> 如何编写及使用自己的Loader</h3> <div class="tip custom-block"><p class="custom-block-title">场景</p> <p>我们需要把<code>.js</code>文件中，所有出现<code>Webpack is good!</code>，改成<code>Webpack is very good!</code>。实际上我们需要编写自己的<code>loader</code>，所以我们有如下的步骤需要处理：</p> <ul><li>新建<code>webpack-loader</code>项目</li> <li>使用<code>npm init -y</code>命令生成package.json文件</li> <li>创建<code>webpack.config.js</code>文件</li> <li>创建<code>src</code>目录，并在<code>src</code>目录下新建<code>index.js</code></li> <li>创建<code>loaders</code>目录，并在<code>loader</code>目录下新建<code>replaceLoader.js</code></li> <li>安装<code>webpack</code>、<code>webpack-cli</code></li></ul></div> <p>新建后的项目目录如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> loaders
<span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">--</span> replaceLoader<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> src
<span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">--</span> index<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
</code></pre></div><p><code>webpack.config.js</code>文件的代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./loaders/replaceLoader.js'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>package.json</code>文件添加<code>build</code>打包命令：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token string">&quot;scripts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;build&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;webpack&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>src/index.js</code>文件中的代码：这个文件使用最简单的例子，只是打印一句话。</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Webpack is good!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>loader/replaceLoader.js</code>文件中的代码：</p> <div class="tip custom-block"><p class="custom-block-title">技巧点</p> <ul><li>编写<code>loader</code>时，<code>module.exports</code>是固定写法，并且它只能是一个普通函数，不能写箭头函数</li> <li><code>source</code>是打包文件的源文件内容</li></ul></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'good'</span><span class="token punctuation">,</span> <span class="token string">'very good'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用我们的<code>loader</code>: 要使用我们的<code>loader</code>，则需要在<code>modules</code>中写<code>loader</code>:</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p><code>resolveLoader</code>配置，告诉了 Webpack 使用<code>loader</code>时，应该去哪些目录下去找，默认是<code>node_modules</code>，做了此项配置后，我们就不用<code>path.resolve(__dirname, './loaders/replaceLoader.js')</code>路径了，因为它会自动去<code>loaders</code>文件夹下面去找。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  resolveLoader<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    modules<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'node_modules'</span><span class="token punctuation">,</span> <span class="token string">'./loaders'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> <span class="token string">'replaceLoader'</span><span class="token punctuation">,</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> <span class="token string">'wanghuayu'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>打包结果：运行<code>npm run build</code>，在生成的<code>dist</code>目录下，打开<code>main.js</code>文件，可以看到文件内容已经成功替换了，说明我们的<code>loader</code>已经使用成功了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/***/</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">:</span>
<span class="token comment">/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/</span>
<span class="token comment">/*! no static exports found */</span>
<span class="token comment">/***/</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;console.log('Webpack is very good!');\n\n//# sourceURL=webpack:///./src/index.js?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/***/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/******/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="如何向自己的loader传参"><a href="#如何向自己的loader传参" aria-hidden="true" class="header-anchor">#</a> 如何向自己的Loader传参</h3> <div class="tip custom-block"><p class="custom-block-title">要解决的问题</p> <ul><li>我们如何返回多个值？</li> <li>我们如何向自己的Loader传递？</li></ul></div> <h4 id="如何返回多个值"><a href="#如何返回多个值" aria-hidden="true" class="header-anchor">#</a> 如何返回多个值</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Webpack 的 API允许我们使用<code>callback(error, result, sourceMap, meta)</code>返回多个值，它有四个参数：</p> <ul><li><code>Error || Null</code> ：错误类型， 没有错误传递<code>null</code></li> <li><code>result</code> ：转换后的结果</li> <li><code>sourceMap</code>：处理分析后的<code>sourceMap</code></li> <li><code>meta</code>: 元信息</li></ul></div> <p>返回多个值，可能有如下情况：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 第三，第四个参数是可选的。</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="如何传递参数"><a href="#如何传递参数" aria-hidden="true" class="header-anchor">#</a> 如何传递参数</h4> <p>我们知道，在使用<code>loader</code>的时候，可以写成如下的形式：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// options里面可以传递一些参数</span>
<span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
  use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    loader<span class="token punctuation">:</span> <span class="token string">'replaceLoader'</span><span class="token punctuation">,</span>
    options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      word<span class="token punctuation">:</span> <span class="token string">'very good'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>再使用<code>options</code>传递参数后，我们可以使用官方提供的<code>loader-utils</code>来获取<code>options</code>参数，可以向下面这样写：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> options <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'good'</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>word<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="如何在自己的loader写异步代码"><a href="#如何在自己的loader写异步代码" aria-hidden="true" class="header-anchor">#</a> 如何在自己的Loader写异步代码</h3> <p>在上面的例子中，我们都是使用了同步的代码，那么如果我们有必须异步的场景，改如何实现呢？我们不妨做这样的假设，先写一个<code>setTimeout</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> options <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'World'</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果你运行了<code>npm run build</code>进行打包，那么一定会报错，解决办法是：使用<code>this.async()</code>主动标识有异步代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> options <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'World'</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>至此，我们已经掌握了如何编写、如何引用、如何传递参数以及如何写异步代码，在下一小节当中我们学习如何编写自己的<code>plugin</code>。</p> <h2 id="编写自己的plugin"><a href="#编写自己的plugin" aria-hidden="true" class="header-anchor">#</a> 编写自己的Plugin</h2> <p>与<code>loader</code>一样，我们在使用 Webpack 的过程中，也经常使用<code>plugin</code>，那么我们学习如何编写自己的<code>plugin</code>是十分有必要的。</p> <h3 id="plugin基础"><a href="#plugin基础" aria-hidden="true" class="header-anchor">#</a> plugin基础</h3> <p><code>plugin</code>基础讲述了怎么编写自己的<code>plugin</code>以及如何使用，与创建自己的<code>loader</code>相似，我们需要创建如下的项目目录结构：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token operator">-</span>plugin
    <span class="token operator">|</span><span class="token operator">--</span> plugins
    <span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> copyWebpackPlugin<span class="token punctuation">.</span>js
    <span class="token operator">|</span><span class="token operator">--</span> src
    <span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>js
    <span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
    <span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
    <span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
</code></pre></div><p><code>copyWebpackPlugins.js</code>中的代码：使用<code>npm run build</code>进行打包时，我们会看到控制台会输出<code>hello, my plugin</code>这段话。</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p><code>plugin</code>与<code>loader</code>不同，<code>plugin</code>需要我们提供的是一个类，这也就解释了我们必须在使用插件时，为什么要进行<code>new</code>操作了。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">copyWebpackPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello, my plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> copyWebpackPlugin<span class="token punctuation">;</span>
</code></pre></div><p><code>webpack.config.js</code>中的代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 引用自己的插件</span>
<span class="token keyword">const</span> copyWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./plugins/copyWebpackPlugin.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// new自己的插件</span>
    <span class="token keyword">new</span> <span class="token class-name">copyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="如何传递参数-2"><a href="#如何传递参数-2" aria-hidden="true" class="header-anchor">#</a> 如何传递参数</h3> <p>在使用其他<code>plugin</code>插件时，我们经常需要传递一些参数进去，那么我们如何在自己的插件中传递参数呢？在哪里接受呢？<br>
其实，插件传参跟其他插件传参是一样的，都是在构造函数中传递一个对象，插件传参如下所示：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> copyWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./plugins/copyWebpackPlugin.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 向我们的插件传递参数</span>
    <span class="token keyword">new</span> <span class="token class-name">copyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'why'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在<code>plugin</code>的构造函数中调用：使用<code>npm run build</code>进行打包，在控制台可以打印出我们传递的参数<code>why</code></p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">copyWebpackPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> copyWebpackPlugin<span class="token punctuation">;</span>
</code></pre></div><h3 id="如何编写及使用自己的plugin"><a href="#如何编写及使用自己的plugin" aria-hidden="true" class="header-anchor">#</a> 如何编写及使用自己的Plugin</h3> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <ul><li><code>apply</code>函数是我们插件在调用时，需要执行的函数</li> <li><code>apply</code>的参数，指的是 Webpack 的实例</li> <li><code>compilation.assets</code>打包的文件信息</li></ul></div> <p>我们现在有这样一个需求：使用自己的插件，在打包目录下生成一个<code>copyright.txt</code>版权文件，那么该如何编写这样的插件呢？
首先我们需要知道<code>plugin</code>的钩子函数，符合我们规则钩子函数叫：<code>emit</code>，它的用法如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">CopyWebpackPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">'CopyWebpackPlugin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> copyrightText <span class="token operator">=</span> <span class="token string">'copyright by why'</span><span class="token punctuation">;</span>
      compilation<span class="token punctuation">.</span>assets<span class="token punctuation">[</span><span class="token string">'copyright.txt'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">source</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> copyrightText
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">size</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> copyrightText<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> CopyWebpackPlugin<span class="token punctuation">;</span>
</code></pre></div><p>使用<code>npm run build</code>命名打包后，我们可以看到<code>dist</code>目录下，确实生成了我们的<code>copyright.txt</code>文件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> dist
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> copyright<span class="token punctuation">.</span>txt
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> main<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> plugins
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> copyWebpackPlugin<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> src
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间: </span> <span class="time">5/16/2019, 5:40:29 PM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/blog/assets/js/app.02d901a9.js" defer></script><script src="/blog/assets/js/4.151a486d.js" defer></script><script src="/blog/assets/js/7.adb24d6e.js" defer></script>
  </body>
</html>
